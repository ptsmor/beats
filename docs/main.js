"use strict";var myMap,intervalId,soundLevel,button=document.querySelector("#hamburger__container"),menu=document.querySelector("#fullscreen-menu"),hamburger=document.querySelector("#hamburger"),body=document.querySelector("body"),toggleMenu=function(e){e.preventDefault(),button.classList.toggle("hamburger__container--active"),hamburger.classList.toggle("hamburger--active"),menu.classList.toggle("fullscreen-menu--open"),body.classList.toggle("locked")},init=(button.addEventListener("click",toggleMenu),$(".fullscreen-menu__link").on("click",toggleMenu),function(){myMap=new ymaps.Map("map",{center:[55.752137,37.589335],zoom:13,controls:[]});for(var e=[[55.756012,37.604021],[55.75092,37.615746],[55.746988,37.591715],[55.744078,37.591413]],t=new ymaps.GeoObjectCollection({},{draggable:!1,iconLayout:"default#image",iconImageHref:"./img/marker8.png",iconImageSize:[46,57],iconImageOffset:[-35,-52]}),n=0;n<e.length;n++)t.add(new ymaps.Placemark(e[n]));myMap.geoObjects.add(t),myMap.behaviors.disable("scrollZoom")}),validateFields=(ymaps.ready(init),function(e,t){return t.forEach(function(e){e.removeClass("input-error"),""==e.val().trim()&&e.addClass("input-error")}),0==e.find(".input-error").length}),sections=($(".form").submit(function(e){e.preventDefault();var e=$(e.currentTarget),t=e.find("[name='name']"),n=e.find("[name='phone']"),o=e.find("[name='comment']"),i=e.find("[name='to']"),a=$("#modal"),r=a.find(".modal__content");a.removeClass("error-modal"),validateFields(e,[t,n,o,i])&&(document.body.classList.add("locked"),(e=$.ajax({url:"https://webdev-api.loftschool.com/sendmail",method:"post",data:{name:t.val(),phone:n.val(),comment:o.val(),to:i.val()}})).done(function(e){r.text(e.message)}),e.fail(function(e){e=e.responseJSON.message;r.text(e),a.addClass("error-modal")}),e.always(function(){$.fancybox.open({src:"#modal",type:"inline"})}))}),$(".app-close-modal").click(function(e){e.preventDefault(),document.body.classList.remove("locked"),$.fancybox.close()}),$("section")),display=$(".maincontent"),sideMenu=$(".fixed-menu"),menuItems=sideMenu.find("fixed-menu__item"),mobileDetect=new MobileDetect(window.navigator.userAgent),isMobile=mobileDetect.mobile(),inScroll=!1,countSectionPosition=(sections.first().addClass("active"),function(e){e*=-100;return isNaN(e)?(console.error("передано не верное значение в countSectionPosition"),0):e}),resetActiveClassForItem=function(e,t,n){e.eq(t).addClass(n).siblings().removeClass(n)},performTransition=function(e){var t;inScroll||document.body.classList.contains("locked")||(inScroll=!0,t=countSectionPosition(e),display.css({transform:"translateY(".concat(t,"%)")}),resetActiveClassForItem(sections,e,"active"),sections.eq(e).addClass("active").siblings().removeClass("active"),setTimeout(function(){inScroll=!1,resetActiveClassForItem(menuItems,e,"fixed-menu__item--active"),sideMenu.find(".fixed-menu__item").eq(e).addClass("fixed-menu__item--active").siblings().removeClass("fixed-menu__item--active")},1300))},viewportScroller=function(){var e=sections.filter(".active"),t=e.next(),n=e.prev();return{next:function(){t.length&&performTransition(t.index())},prev:function(){n.length&&performTransition(n.index())}}},playerBtn=($(window).on("wheel",function(e){var e=e.originalEvent.deltaY,t=viewportScroller();0<e&&t.next(),e<0&&t.prev()}),$(window).on("keydown",function(e){var t=e.target.tagName.toLowerCase(),t="input"==t||"textarea"==t,n=viewportScroller();if(!t)switch(e.keyCode){case 38:n.prev();break;case 40:n.next()}}),$(".wrapper").on("touchmove",function(e){return e.preventDefault()}),$("[data-scroll-to]").click(function(e){e.preventDefault();e=$(e.currentTarget).attr("data-scroll-to"),e=$("[data-section-id=".concat(e,"]"));performTransition(e.index())}),isMobile&&$("body").swipe({swipe:function(e,t){var n=viewportScroller(),t="down"==t?"prev":"up"==t?"next":"";t&&n[t]()}}),document.querySelector(".video__player-img")),video=document.getElementById("player"),playerPlayBtn=document.querySelector(".player__start"),durationControl=document.getElementById("durationLevel"),soundControl=document.getElementById("micLevel"),soundBtn=document.getElementById("sound");function playStop(){playerBtn.classList.toggle("video__player-img--active"),playerPlayBtn.classList.toggle("player__start--active"),video.paused?(video.play(),intervalId=setInterval(updateDuration,1e3/60)):(clearInterval(intervalId),video.pause())}function setVideoDuration(){video.currentTime=durationControl.value,updateDuration()}function updateDuration(){durationControl.value=video.currentTime;var e=video.duration/100,e=video.currentTime/e;durationControl.style.background="linear-gradient(90deg, #FF0000 0%, #FF0000 ".concat(e,"%, #626262 ").concat(e,"%)")}function changeSoundVolume(){video.volume=soundControl.value/10,0==video.volume?soundBtn.classList.add("muted"):soundBtn.classList.remove("muted")}function soundOf(){0==video.volume?(video.volume=soundLevel,soundControl.value=10*soundLevel,soundBtn.classList.remove("muted")):(soundLevel=video.volume,video.volume=0,soundControl.value=0,soundBtn.classList.add("muted"))}video.addEventListener("loadeddata",function(){video.addEventListener("click",playStop);for(var e=document.querySelectorAll(".play"),t=0;t<e.length;t++)e[t].addEventListener("click",playStop);durationControl.min=0,durationControl.value=0,durationControl.max=parseInt(video.duration),durationControl.addEventListener("input",setVideoDuration),soundControl.min=0,soundControl.max=10,soundControl.value=soundControl.max,soundControl.addEventListener("input",changeSoundVolume),soundBtn.addEventListener("click",soundOf),video.addEventListener("ended",function(){playerBtn.classList.toggle("video__player-img--active"),playerPlayBtn.classList.remove("player__start--active"),video.currentTime=0})});var list=$(".products-menu__list"),slider=(list.on("click",".product",function(e){e.preventDefault(),$(this).siblings("li").removeClass("product--active"),$(this).toggleClass("product--active");var e=$(this).find(".product__content"),t=0,n=524;$(window).width()<=768&&480<$(window).width()&&(t=$(".product__title").width()*$(".product__title").length,n=$(window).width()-t),$(window).width()<=480&&(t=$(".product__title").width(),n=$(window).width()-t),list.find(".product__content").css("width",0),$(this).hasClass("product--active")&&e.css("width","".concat(n,"px"))}),$(".shop__list").bxSlider({pager:!1,controls:!1})),findBlockByAlias=($(".shop__btn_left").click(function(e){e.preventDefault(),slider.goToPrevSlide()}),$(".shop__btn_right").click(function(e){e.preventDefault(),slider.goToNextSlide()}),function(n){return $(".reviews__item").filter(function(e,t){return $(t).attr("data-linked-with")==n})}),openItem=($(".interactive-avatar__link").click(function(e){e.preventDefault();var e=$(e.currentTarget),t=e.attr("data-open"),t=findBlockByAlias(t),e=e.closest(".interactive-avatar");t.addClass("reviews__item--active").siblings().removeClass("reviews__item--active"),e.addClass("interactive-avatar--active").siblings().removeClass("interactive-avatar--active")}),function(e){var e=e.closest(".slider__item"),t=e.find(".slider__description"),n=t.find(".slider__description--wrap").height();e.addClass(".slider__item--active"),t.height(n)}),closeEveryItem=function(e){var t=e.find(".slider__description");e.find(".slider__item").removeClass(".slider__item--active"),t.height(0)};$(".slider__name").click(function(e){var e=$(e.currentTarget),t=e.closest(".slider__list");e.closest(".slider__item").hasClass(".slider__item--active")?closeEveryItem(t):(closeEveryItem(t),openItem(e))});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJtYXAuanMiLCJwbGF5ZXIuanMiLCJtb2RhbC5qcyIsIm9wcy5qcyIsInByb2R1Y3RzLmpzIiwic2hvcHNsaWRlLmpzIiwidGFicy5qcyIsInRlYW0uanMiXSwibmFtZXMiOlsibXlNYXAiLCJpbnRlcnZhbElkIiwic291bmRMZXZlbCIsImJ1dHRvbiIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIm1lbnUiLCJoYW1idXJnZXIiLCJib2R5IiwidG9nZ2xlTWVudSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImNsYXNzTGlzdCIsInRvZ2dsZSIsImluaXQiLCJhZGRFdmVudExpc3RlbmVyIiwiJCIsIm9uIiwieW1hcHMiLCJNYXAiLCJjZW50ZXIiLCJ6b29tIiwiY29udHJvbHMiLCJjb29yZHMiLCJteUNvbGxlY3Rpb24iLCJHZW9PYmplY3RDb2xsZWN0aW9uIiwiZHJhZ2dhYmxlIiwiaWNvbkxheW91dCIsImljb25JbWFnZUhyZWYiLCJpY29uSW1hZ2VTaXplIiwiaWNvbkltYWdlT2Zmc2V0IiwiaSIsImxlbmd0aCIsImFkZCIsIlBsYWNlbWFyayIsImdlb09iamVjdHMiLCJiZWhhdmlvcnMiLCJkaXNhYmxlIiwidmFsaWRhdGVGaWVsZHMiLCJyZWFkeSIsImZvcm0iLCJmaWVsZHNBcnJheSIsImZvckVhY2giLCJmaWVsZCIsInJlbW92ZUNsYXNzIiwidmFsIiwidHJpbSIsImFkZENsYXNzIiwiZmluZCIsInNlY3Rpb25zIiwic3VibWl0IiwiY3VycmVudFRhcmdldCIsIm5hbWUiLCJwaG9uZSIsImNvbW1lbnQiLCJ0byIsIm1vZGFsIiwiY29udGVudCIsInJlcXVlc3QiLCJhamF4IiwidXJsIiwibWV0aG9kIiwiZGF0YSIsImRvbmUiLCJ0ZXh0IiwibWVzc2FnZSIsImZhaWwiLCJyZXNwb25zZUpTT04iLCJhbHdheXMiLCJmYW5jeWJveCIsIm9wZW4iLCJzcmMiLCJ0eXBlIiwiY2xpY2siLCJyZW1vdmUiLCJjbG9zZSIsImRpc3BsYXkiLCJzaWRlTWVudSIsIm1lbnVJdGVtcyIsIm1vYmlsZURldGVjdCIsIk1vYmlsZURldGVjdCIsIndpbmRvdyIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsImlzTW9iaWxlIiwibW9iaWxlIiwiaW5TY3JvbGwiLCJjb3VudFNlY3Rpb25Qb3NpdGlvbiIsImZpcnN0Iiwic2VjdGlvbkVxIiwicG9zaXRpb24iLCJpc05hTiIsImNvbnNvbGUiLCJlcnJvciIsInJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtIiwiaXRlbXMiLCJpdGVtRXEiLCJhY3RpdmVDbGFzcyIsImVxIiwic2libGluZ3MiLCJwZXJmb3JtVHJhbnNpdGlvbiIsImNvbnRhaW5zIiwiY3NzIiwidHJhbnNmb3JtIiwiY29uY2F0Iiwic2V0VGltZW91dCIsInRyYW5zaXRpb25PdmVyIiwidmlld3BvcnRTY3JvbGxlciIsImFjdGl2ZVNlY3Rpb24iLCJmaWx0ZXIiLCJuZXh0U2VjdGlvbiIsIm5leHQiLCJwcmV2U2VjdGlvbiIsInByZXYiLCJpbmRleCIsInBsYXllckJ0biIsImRlbHRhWSIsIm9yaWdpbmFsRXZlbnQiLCJzY3JvbGxlciIsInRhZ05hbWUiLCJ0YXJnZXQiLCJ0b0xvd2VyQ2FzZSIsInVzZXJUeXBpbmdJbklucHV0cyIsImtleUNvZGUiLCJhdHRyIiwicmVxU2VjdGlvbiIsInN3aXBlIiwiZXZlbnQiLCJkaXJlY3Rpb24iLCJzY3JvbGxEaXJlY3Rpb24iLCJ2aWRlbyIsImdldEVsZW1lbnRCeUlkIiwicGxheWVyUGxheUJ0biIsImR1cmF0aW9uQ29udHJvbCIsInNvdW5kQ29udHJvbCIsInNvdW5kQnRuIiwicGxheVN0b3AiLCJwYXVzZWQiLCJwbGF5Iiwic2V0SW50ZXJ2YWwiLCJ1cGRhdGVEdXJhdGlvbiIsImNsZWFySW50ZXJ2YWwiLCJwYXVzZSIsInNldFZpZGVvRHVyYXRpb24iLCJjdXJyZW50VGltZSIsInZhbHVlIiwic3RlcCIsImR1cmF0aW9uIiwicGVyY2VudCIsInN0eWxlIiwiYmFja2dyb3VuZCIsImNoYW5nZVNvdW5kVm9sdW1lIiwidm9sdW1lIiwic291bmRPZiIsInBsYXlCdXR0b25zIiwicXVlcnlTZWxlY3RvckFsbCIsIm1pbiIsIm1heCIsInBhcnNlSW50IiwibGlzdCIsInNsaWRlciIsInRoaXMiLCJ0b2dnbGVDbGFzcyIsIiRjb250ZW50IiwiY3VyV2lkdGgiLCJuZXdXaWR0aCIsIndpZHRoIiwiaGFzQ2xhc3MiLCJieFNsaWRlciIsInBhZ2VyIiwiZmluZEJsb2NrQnlBbGlhcyIsImdvVG9QcmV2U2xpZGUiLCJnb1RvTmV4dFNsaWRlIiwiYWxpYXMiLCJuZHgiLCJpdGVtIiwib3Blbkl0ZW0iLCIkdGhpcyIsIml0ZW1Ub1Nob3ciLCJjdXJJdGVtIiwiY2xvc2VzdCIsImNvbnRhaW5lciIsImNvbnRlbnRCbG9jayIsInJlcUhlaWdodCIsImhlaWdodCIsImNsb3NlRXZlcnlJdGVtIl0sIm1hcHBpbmdzIjoiYUFBQSxJQ0FBQSxNQzRKQUMsV0FDQUMsV0Y3SkFDLE9BQUFDLFNBQUFDLGNBQUEseUJBQ0FDLEtBQUFGLFNBQUFDLGNBQUEsb0JBREFFLFVBQUFILFNBQUFDLGNBQUEsY0FDQUcsS0FBQUosU0FBQUMsY0FBQSxRQXNCQUksV0FBQSxTQUFBQyxHQUNBQSxFQUFBQyxpQkFDQVIsT0FBQVMsVUFBQUMsT0FBQSxnQ0FDQU4sVUFBQUssVUFBQUMsT0FBQSxxQkFHQVAsS0FBQU0sVUFBQUMsT0FBQSx5QkFEQUwsS0FBQUksVUFBQUMsT0FBQSxXQzNCQUMsTURnQ0FYLE9BQUFZLGlCQUFBLFFBQUFOLFlDakNBTyxFQUFBLDBCQUFBQyxHQUFBLFFBQUFSLFlBQ0EsV0FDQVQsTUFBQSxJQUFBa0IsTUFBQUMsSUFBQSxNQUFBLENBQ0FDLE9BQUEsQ0FBQSxVQUFBLFdBQ0FDLEtBQUEsR0FDQUMsU0FBQSxLQW9CQSxJQWpCQSxJQUFBQyxFQUFBLENBQ0EsQ0FBQSxVQUFBLFdBQ0EsQ0FBQSxTQUFBLFdBQ0EsQ0FBQSxVQUFBLFdBQ0EsQ0FBQSxVQUFBLFlBRUFDLEVBQUEsSUFBQU4sTUFBQU8sb0JBQ0EsR0FDQSxDQUNBQyxXQUFBLEVBQ0FDLFdBQUEsZ0JBQ0FDLGNBQUEsb0JBQ0FDLGNBQUEsQ0FBQSxHQUFBLElBQ0FDLGdCQUFBLEVBQUEsSUFBQSxNQUlBQyxFQUFBLEVBQUFBLEVBQUFSLEVBQUFTLE9BQUFELElBQ0FQLEVBQUFTLElBQUEsSUFBQWYsTUFBQWdCLFVBQUFYLEVBQUFRLEtBR0EvQixNQUFBbUMsV0FBQUYsSUFBQVQsR0FFQXhCLE1BQUFvQyxVQUFBQyxRQUFBLGdCRS9CQUMsZ0JGa0NBcEIsTUFBQXFCLE1BQUF6QixNRWxDQSxTQUFBMEIsRUFBQUMsR0FVQSxPQVRBQSxFQUFBQyxRQUFBLFNBQUFDLEdBQ0FBLEVBQUFDLFlBQUEsZUFDQSxJQUFBRCxFQUFBRSxNQUFBQyxRQUNBSCxFQUFBSSxTQUFBLGlCQU1BLEdBRkFQLEVBQUFRLEtBQUEsZ0JBRUFoQixTQ1ZBaUIsVURhQWpDLEVBQUEsU0FBQWtDLE9BQUEsU0FBQXhDLEdBQ0FBLEVBQUFDLGlCQUVBLElBQUE2QixFQUFBeEIsRUFBQU4sRUFBQXlDLGVBQ0FDLEVBQUFaLEVBQUFRLEtBQUEsaUJBQ0FLLEVBQUFiLEVBQUFRLEtBQUEsa0JBQ0FNLEVBQUFkLEVBQUFRLEtBQUEsb0JBQ0FPLEVBQUFmLEVBQUFRLEtBQUEsZUFDQVEsRUFBQXhDLEVBQUEsVUFDQXlDLEVBQUFELEVBQUFSLEtBQUEsbUJBRUFRLEVBQUFaLFlBQUEsZUFFQU4sZUFBQUUsRUFBQSxDQUFBWSxFQUFBQyxFQUFBQyxFQUFBQyxNQUdBbkQsU0FBQUksS0FBQUksVUFBQXFCLElBQUEsV0FDQXlCLEVBQUExQyxFQUFBMkMsS0FBQSxDQUNBQyxJQUFBLDZDQUNBQyxPQUFBLE9BQ0FDLEtBQUEsQ0FDQVYsS0FBQUEsRUFBQVAsTUFDQVEsTUFBQUEsRUFBQVIsTUFDQVMsUUFBQUEsRUFBQVQsTUFDQVUsR0FBQUEsRUFBQVYsVUFJQWtCLEtBQUEsU0FBQUQsR0FDQUwsRUFBQU8sS0FBQUYsRUFBQUcsV0FHQVAsRUFBQVEsS0FBQSxTQUFBSixHQUNBRyxFQUFBSCxFQUFBSyxhQUFBRixRQUNBUixFQUFBTyxLQUFBQyxHQUNBVCxFQUFBVCxTQUFBLGlCQUdBVyxFQUFBVSxPQUFBLFdBQ0FwRCxFQUFBcUQsU0FBQUMsS0FBQSxDQUNBQyxJQUFBLFNBQ0FDLEtBQUEsZ0JBTUF4RCxFQUFBLG9CQUFBeUQsTUFBQSxTQUFBL0QsR0FDQUEsRUFBQUMsaUJBRUFQLFNBQUFJLEtBQUFJLFVBQUE4RCxPQUFBLFVBRUExRCxFQUFBcUQsU0FBQU0sVUNqRUEzRCxFQUFBLFlBQ0E0RCxRQUFBNUQsRUFBQSxnQkFDQTZELFNBQUE3RCxFQUFBLGVBQ0E4RCxVQUFBRCxTQUFBN0IsS0FBQSxvQkFFQStCLGFBQUEsSUFBQUMsYUFBQUMsT0FBQUMsVUFBQUMsV0FDQUMsU0FBQUwsYUFBQU0sU0FFQUMsVUFBQSxFQUlBQyxzQkFGQXRDLFNBQUF1QyxRQUFBekMsU0FBQSxVQUVBLFNBQUEwQyxHQUVBQyxJQUFBLElBRUEsT0FBQUMsTUFBQUQsSUFDQUUsUUFBQUMsTUFBQSxzREFDQSxHQUVBSCxJQUdBSSx3QkFBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUNBRixFQUFBRyxHQUFBRixHQUFBakQsU0FBQWtELEdBQUFFLFdBQUF2RCxZQUFBcUQsSUFHQUcsa0JBQUEsU0FBQVgsR0FFQSxJQUtBQyxFQUxBSixVQUFBbEYsU0FBQUksS0FBQUksVUFBQXlGLFNBQUEsWUFJQWYsVUFBQSxFQUNBSSxFQUFBSCxxQkFBQUUsR0FJQWIsUUFBQTBCLElBQUEsQ0FDQUMsVUFBQSxjQUFBQyxPQUFBZCxFQUFBLFFBR0FJLHdCQUFBN0MsU0FBQXdDLEVBQUEsVUFDQXhDLFNBQUFpRCxHQUFBVCxHQUFBMUMsU0FBQSxVQUFBb0QsV0FBQXZELFlBQUEsVUFFQTZELFdBQUEsV0FDQW5CLFVBQUEsRUFFQVEsd0JBQUFoQixVQUFBVyxFQUFBLDRCQUdBWixTQUNBN0IsS0FBQSxxQkFDQWtELEdBQUFULEdBQ0ExQyxTQUFBLDRCQUNBb0QsV0FDQXZELFlBQUEsNkJBQ0E4RCxRQUtBQyxpQkFBQSxXQUNBLElBQUFDLEVBQUEzRCxTQUFBNEQsT0FBQSxXQUNBQyxFQUFBRixFQUFBRyxPQUNBQyxFQUFBSixFQUFBSyxPQUVBLE1BQUEsQ0FDQUYsS0FEQSxXQUVBRCxFQUFBOUUsUUFDQW9FLGtCQUFBVSxFQUFBSSxVQUdBRCxLQU5BLFdBT0FELEVBQUFoRixRQUNBb0Usa0JBQUFZLEVBQUFFLFlGMEVBQyxXRWhFQW5HLEVBQUFpRSxRQUFBaEUsR0FBQSxRQUFBLFNBQUFQLEdBQ0EsSUFBQTBHLEVBQUExRyxFQUFBMkcsY0FBQUQsT0FDQUUsRUFBQVgsbUJBRUEsRUFBQVMsR0FDQUUsRUFBQVAsT0FHQUssRUFBQSxHQUNBRSxFQUFBTCxTQUtBakcsRUFBQWlFLFFBQUFoRSxHQUFBLFVBQUEsU0FBQVAsR0FFQSxJQUFBNkcsRUFBQTdHLEVBQUE4RyxPQUFBRCxRQUFBRSxjQUNBQyxFQUFBLFNBQUFILEdBQUEsWUFBQUEsRUFDQUQsRUFBQVgsbUJBRUEsSUFBQWUsRUFFQSxPQUFBaEgsRUFBQWlILFNBQ0EsS0FBQSxHQUNBTCxFQUFBTCxPQUNBLE1BRUEsS0FBQSxHQUNBSyxFQUFBUCxVQU9BL0YsRUFBQSxZQUFBQyxHQUFBLFlBQUEsU0FBQVAsR0FBQSxPQUFBQSxFQUFBQyxtQkFFQUssRUFBQSxvQkFBQXlELE1BQUEsU0FBQS9ELEdBQ0FBLEVBQUFDLGlCQUdBNkcsRUFEQXhHLEVBQUFOLEVBQUF5QyxlQUNBeUUsS0FBQSxrQkFDQUMsRUFBQTdHLEVBQUEsb0JBQUF3RixPQUFBZ0IsRUFBQSxNQUVBcEIsa0JBQUF5QixFQUFBWCxXQUdBOUIsVUFFQXBFLEVBQUEsUUFBQThHLE1BQUEsQ0FDQUEsTUFBQSxTQUFBQyxFQUFBQyxHQUNBLElBQUFWLEVBQUFYLG1CQUNBc0IsRUFHQSxRQUFBRCxFQUFBLE9BREEsTUFBQUEsRUFBQSxPQUZBLEdBTUFDLEdBQ0FYLEVBQUFXLFFGS0E3SCxTQUFBQyxjQUFBLHVCQUNBNkgsTUFBQTlILFNBQUErSCxlQUFBLFVBQ0FDLGNBQUFoSSxTQUFBQyxjQUFBLGtCQUNBZ0ksZ0JBQUFqSSxTQUFBK0gsZUFBQSxpQkFDQUcsYUFBQWxJLFNBQUErSCxlQUFBLFlBQ0FJLFNBQUFuSSxTQUFBK0gsZUFBQSxTQXNDQSxTQUFBSyxXQUNBckIsVUFBQXZHLFVBQUFDLE9BQUEsNkJBQ0F1SCxjQUFBeEgsVUFBQUMsT0FBQSx5QkFDQXFILE1BQUFPLFFBQ0FQLE1BQUFRLE9BQ0F6SSxXQUFBMEksWUFBQUMsZUFBQSxJQUFBLE1BR0FDLGNBQUE1SSxZQUNBaUksTUFBQVksU0FLQSxTQUFBQyxtQkFDQWIsTUFBQWMsWUFBQVgsZ0JBQUFZLE1BQ0FMLGlCQUdBLFNBQUFBLGlCQUNBUCxnQkFBQVksTUFBQWYsTUFBQWMsWUFDQSxJQUFBRSxFQUFBaEIsTUFBQWlCLFNBQUEsSUFDQUMsRUFBQWxCLE1BQUFjLFlBQUFFLEVBQ0FiLGdCQUFBZ0IsTUFBQUMsV0FBQSw4Q0FBQTlDLE9BQUE0QyxFQUFBLGVBQUE1QyxPQUFBNEMsRUFBQSxNQUdBLFNBQUFHLG9CQUNBckIsTUFBQXNCLE9BQUFsQixhQUFBVyxNQUFBLEdBQ0EsR0FBQWYsTUFBQXNCLE9BQ0FqQixTQUFBM0gsVUFBQXFCLElBQUEsU0FFQXNHLFNBQUEzSCxVQUFBOEQsT0FBQSxTQUlBLFNBQUErRSxVQUNBLEdBQUF2QixNQUFBc0IsUUFDQXRCLE1BQUFzQixPQUFBdEosV0FDQW9JLGFBQUFXLE1BQUEsR0FBQS9JLFdBQ0FxSSxTQUFBM0gsVUFBQThELE9BQUEsV0FFQXhFLFdBQUFnSSxNQUFBc0IsT0FDQXRCLE1BQUFzQixPQUFBLEVBQ0FsQixhQUFBVyxNQUFBLEVBQ0FWLFNBQUEzSCxVQUFBcUIsSUFBQSxVQTdFQWlHLE1BQUFuSCxpQkFBQSxhQUFBLFdBSUFtSCxNQUFBbkgsaUJBQUEsUUFBQXlILFVBSUEsSUFGQSxJQUFBa0IsRUFBQXRKLFNBQUF1SixpQkFBQSxTQUVBNUgsRUFBQSxFQUFBQSxFQUFBMkgsRUFBQTFILE9BQUFELElBQ0EySCxFQUFBM0gsR0FBQWhCLGlCQUFBLFFBQUF5SCxVQUdBSCxnQkFBQXVCLElBQUEsRUFDQXZCLGdCQUFBWSxNQUFBLEVBQ0FaLGdCQUFBd0IsSUFBQUMsU0FBQTVCLE1BQUFpQixVQUVBZCxnQkFBQXRILGlCQUFBLFFBQUFnSSxrQkFFQVQsYUFBQXNCLElBQUEsRUFDQXRCLGFBQUF1QixJQUFBLEdBQ0F2QixhQUFBVyxNQUFBWCxhQUFBdUIsSUFDQXZCLGFBQUF2SCxpQkFBQSxRQUFBd0ksbUJBRUFoQixTQUFBeEgsaUJBQUEsUUFBQTBJLFNBQ0F2QixNQUFBbkgsaUJBQUEsUUFBQSxXQUNBb0csVUFBQXZHLFVBQUFDLE9BQUEsNkJBQ0F1SCxjQUFBeEgsVUFBQThELE9BQUEseUJBQ0F3RCxNQUFBYyxZQUFBLE1HMUxBLElBQUFlLEtBQUEvSSxFQUFBLHdCQ0FBZ0osUURFQUQsS0FBQTlJLEdBQUEsUUFBQSxXQUFBLFNBQUFQLEdBQ0FBLEVBQUFDLGlCQUNBSyxFQUFBaUosTUFBQTlELFNBQUEsTUFBQXZELFlBQUEsbUJBQ0E1QixFQUFBaUosTUFBQUMsWUFBQSxtQkFDQSxJQUFBQyxFQUFBbkosRUFBQWlKLE1BQUFqSCxLQUFBLHFCQUVBb0gsRUFBQSxFQUNBQyxFQUFBLElBRUFySixFQUFBaUUsUUFBQXFGLFNBQUEsS0FBQSxJQUFBdEosRUFBQWlFLFFBQUFxRixVQUNBRixFQUFBcEosRUFBQSxtQkFBQXNKLFFBQUF0SixFQUFBLG1CQUFBZ0IsT0FDQXFJLEVBQUFySixFQUFBaUUsUUFBQXFGLFFBQUFGLEdBR0FwSixFQUFBaUUsUUFBQXFGLFNBQUEsTUFDQUYsRUFBQXBKLEVBQUEsbUJBQUFzSixRQUNBRCxFQUFBckosRUFBQWlFLFFBQUFxRixRQUFBRixHQUdBTCxLQUFBL0csS0FBQSxxQkFBQXNELElBQUEsUUFBQSxHQUVBdEYsRUFBQWlKLE1BQUFNLFNBQUEsb0JBQ0FKLEVBQUE3RCxJQUFBLFFBQUEsR0FBQUUsT0FBQTZELEVBQUEsU0N4QkFySixFQUFBLGVBQUF3SixTQUFBLENBQ0FDLE9BQUEsRUFDQW5KLFVBQUEsS0NGQW9KLGtCREtBMUosRUFBQSxtQkFBQXlELE1BQUEsU0FBQS9ELEdBQ0FBLEVBQUFDLGlCQUVBcUosT0FBQVcsa0JBRUEzSixFQUFBLG9CQUFBeUQsTUFBQSxTQUFBL0QsR0FDQUEsRUFBQUMsaUJBRUFxSixPQUFBWSxrQkNiQSxTQUFBQyxHQUNBLE9BQUE3SixFQUFBLGtCQUFBNkYsT0FBQSxTQUFBaUUsRUFBQUMsR0FDQSxPQUFBL0osRUFBQStKLEdBQUFuRCxLQUFBLHFCQUFBaUQsTUNGQUcsVURNQWhLLEVBQUEsNkJBQUF5RCxNQUFBLFNBQUEvRCxHQUNBQSxFQUFBQyxpQkFFQSxJQUFBc0ssRUFBQWpLLEVBQUFOLEVBQUF5QyxlQUNBcUUsRUFBQXlELEVBQUFyRCxLQUFBLGFBQ0FzRCxFQUFBUixpQkFBQWxELEdBQ0EyRCxFQUFBRixFQUFBRyxRQUFBLHVCQUVBRixFQUNBbkksU0FBQSx5QkFDQW9ELFdBQ0F2RCxZQUFBLHlCQUVBdUksRUFDQXBJLFNBQUEsOEJBQ0FvRCxXQUNBdkQsWUFBQSxnQ0N0QkEsU0FBQW1JLEdBQ0EsSUFBQU0sRUFBQU4sRUFBQUssUUFBQSxpQkFDQUUsRUFBQUQsRUFBQXJJLEtBQUEsd0JBRUF1SSxFQURBRCxFQUFBdEksS0FBQSw4QkFDQXdJLFNBRUFILEVBQUF0SSxTQUFBLHlCQUNBdUksRUFBQUUsT0FBQUQsS0FHQUUsZUFBQSxTQUFBSixHQUNBLElBQUF0RixFQUFBc0YsRUFBQXJJLEtBQUEsd0JBQ0FxSSxFQUFBckksS0FBQSxpQkFFQUosWUFBQSx5QkFDQW1ELEVBQUF5RixPQUFBLElBR0F4SyxFQUFBLGlCQUFBeUQsTUFBQSxTQUFBL0QsR0FDQSxJQUFBdUssRUFBQWpLLEVBQUFOLEVBQUF5QyxlQUNBa0ksRUFBQUosRUFBQUcsUUFBQSxpQkFDQUgsRUFBQUcsUUFBQSxpQkFDQWIsU0FBQSx5QkFDQWtCLGVBQUFKLElBRUFJLGVBQUFKLEdBQ0FMLFNBQUFDIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgYnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2hhbWJ1cmdlcl9fY29udGFpbmVyJyk7XHJcbmxldCBtZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2Z1bGxzY3JlZW4tbWVudScpOyAgXHJcbmxldCBoYW1idXJnZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjaGFtYnVyZ2VyJylcclxubGV0IGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XHJcblxyXG4vLyBsZXQgdG9nZ2xlTWVudSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgXHJcbi8vICAgICBidXR0b24uY2xhc3NMaXN0LnRvZ2dsZSgnaGFtYnVyZ2VyX19jb250YWluZXItLWFjdGl2ZScpO1xyXG4vLyAgICAgaGFtYnVyZ2VyLmNsYXNzTGlzdC50b2dnbGUoJ2hhbWJ1cmdlci0tYWN0aXZlJylcclxuLy8gICAgIG1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnZnVsbHNjcmVlbi1tZW51LS1vcGVuJyk7XHJcbiAgICAvLyBib2R5LmNsYXNzTGlzdC50b2dnbGUoJ2JvZHktYWN0aXZlLW1lbnUnKTtcclxuLy8gfTtcclxuXHJcbi8vIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsaWNrTWVudSA9PiB7XHJcbi8vICAgICBjbGlja01lbnUucHJldmVudERlZmF1bHQoKTtcclxuLy8gICAgIGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCdoYW1idXJnZXJfX2NvbnRhaW5lci0tYWN0aXZlJyk7XHJcbi8vICAgICBoYW1idXJnZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGFtYnVyZ2VyLS1hY3RpdmUnKVxyXG4vLyAgICAgbWVudS5jbGFzc0xpc3QudG9nZ2xlKCdmdWxsc2NyZWVuLW1lbnUtLW9wZW4nKTtcclxuLy8gICAgIGJvZHkuY2xhc3NMaXN0LnRvZ2dsZSgnYm9keS1hY3RpdmUtbWVudScpO1xyXG4vLyAgICAgLy8gJCgnLm1lbnVfX2xpbmsnKS5vbignY2xpY2snLCBjbGlja01lbnUpO1xyXG4vLyB9KTsgICBcclxuLy8gJCgnLm1lbnVfX2xpbmsnKS5vbignY2xpY2snLCBjbGlja01lbnUpO1xyXG5cclxubGV0IHRvZ2dsZU1lbnUgPSBmdW5jdGlvbihlKSB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBidXR0b24uY2xhc3NMaXN0LnRvZ2dsZSgnaGFtYnVyZ2VyX19jb250YWluZXItLWFjdGl2ZScpO1xyXG4gICAgaGFtYnVyZ2VyLmNsYXNzTGlzdC50b2dnbGUoJ2hhbWJ1cmdlci0tYWN0aXZlJylcclxuICAgIG1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnZnVsbHNjcmVlbi1tZW51LS1vcGVuJyk7XHJcbiAgICBib2R5LmNsYXNzTGlzdC50b2dnbGUoJ2xvY2tlZCcpO1xyXG59XHJcblxyXG5idXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0b2dnbGVNZW51KTsgICBcclxuJCgnLmZ1bGxzY3JlZW4tbWVudV9fbGluaycpLm9uKCdjbGljaycsIHRvZ2dsZU1lbnUpO1xyXG4iLCJsZXQgbXlNYXA7XHJcbmNvbnN0IGluaXQgPSAoKSA9PiB7XHJcbiAgbXlNYXAgPSBuZXcgeW1hcHMuTWFwKFwibWFwXCIsIHtcclxuICAgIGNlbnRlcjogWzU1Ljc1MjEzNywgMzcuNTg5MzM1XSxcclxuICAgIHpvb206IDEzLFxyXG4gICAgY29udHJvbHM6IFtdLFxyXG4gIH0pO1xyXG5cclxuICBsZXQgY29vcmRzID0gW1xyXG4gICAgICBbNTUuNzU2MDEyLCAzNy42MDQwMjFdLFxyXG4gICAgICBbNTUuNzUwOTIsIDM3LjYxNTc0Nl0sXHJcbiAgICAgIFs1NS43NDY5ODgsIDM3LjU5MTcxNV0sXHJcbiAgICAgIFs1NS43NDQwNzgsIDM3LjU5MTQxM10sXHJcbiAgICBdLFxyXG4gICAgbXlDb2xsZWN0aW9uID0gbmV3IHltYXBzLkdlb09iamVjdENvbGxlY3Rpb24oXHJcbiAgICAgIHt9LFxyXG4gICAgICB7XHJcbiAgICAgICAgZHJhZ2dhYmxlOiBmYWxzZSxcclxuICAgICAgICBpY29uTGF5b3V0OiBcImRlZmF1bHQjaW1hZ2VcIixcclxuICAgICAgICBpY29uSW1hZ2VIcmVmOiBcIi4vaW1nL21hcmtlcjgucG5nXCIsXHJcbiAgICAgICAgaWNvbkltYWdlU2l6ZTogWzQ2LCA1N10sXHJcbiAgICAgICAgaWNvbkltYWdlT2Zmc2V0OiBbLTM1LCAtNTJdLFxyXG4gICAgICB9XHJcbiAgICApO1xyXG5cclxuICBmb3IgKGxldCBpID0gMDsgaSA8IGNvb3Jkcy5sZW5ndGg7IGkrKykge1xyXG4gICAgbXlDb2xsZWN0aW9uLmFkZChuZXcgeW1hcHMuUGxhY2VtYXJrKGNvb3Jkc1tpXSkpO1xyXG4gIH1cclxuXHJcbiAgbXlNYXAuZ2VvT2JqZWN0cy5hZGQobXlDb2xsZWN0aW9uKTtcclxuXHJcbiAgbXlNYXAuYmVoYXZpb3JzLmRpc2FibGUoXCJzY3JvbGxab29tXCIpO1xyXG59O1xyXG5cclxueW1hcHMucmVhZHkoaW5pdCk7XHJcbiIsIi8vIGxldCBwbGF5ZXI7XHJcblxyXG4vLyBjb25zdCBwbGF5ZXJDb250YWluZXIgPSAkKFwiLnBsYXllclwiKTtcclxuLy8gY29uc3QgcGxheWVyU3RhcnQgPSAkKFwiLnBsYXllcl9fc3RhcnRcIik7XHJcbi8vIGxldCBldmVudHNJbml0ID0gKCkgPT4ge1xyXG4vLyAgICQoXCIucGxheWVyX19zdGFydFwiKS5jbGljaygoZSkgPT4ge1xyXG4vLyAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4vLyAgICAgaWYgKHBsYXllclN0YXJ0Lmhhc0NsYXNzKFwicGxheWVyX19zdGFydC0tYWN0aXZlXCIpKSB7XHJcbi8vICAgICAgIHBsYXllci5wYXVzZVZpZGVvKCk7XHJcbi8vICAgICB9IGVsc2Uge1xyXG4vLyAgICAgICBwbGF5ZXIucGxheVZpZGVvKCk7XHJcbi8vICAgICB9XHJcbi8vICAgfSk7XHJcblxyXG4vLyAgICQoXCIucGxheWVyX19wbGF5YmFja1wiKS5jbGljaygoZSkgPT4ge1xyXG4vLyAgICAgY29uc3QgYmFyID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4vLyAgICAgY29uc3QgY2xpY2tlZFBvc2l0aW9uID0gZS5vcmlnaW5hbEV2ZW50LmxheWVyWDtcclxuXHJcbi8vICAgICBjb25zdCBuZXdCdXR0b25Qb3NpdGlvblBlcmNlbnQgPSAoY2xpY2tlZFBvc2l0aW9uIC8gYmFyLndpZHRoKCkpICogMTAwO1xyXG4vLyAgICAgY29uc3QgbmV3UGxheWJhY2tQb3NpdGlvblNlYyA9XHJcbi8vICAgICAgIChwbGF5ZXIuZ2V0RHVyYXRpb24oKSAvIDEwMCkgKiBuZXdCdXR0b25Qb3NpdGlvblBlcmNlbnQ7XHJcblxyXG4vLyAgICAgJChcIi5wbGF5ZXJfX3BsYXliYWNrLWxpbmVcIikuY3NzKHtcclxuLy8gICAgICAgd2lkdGg6IGAke25ld0J1dHRvblBvc2l0aW9uUGVyY2VudH0lYCxcclxuLy8gICAgIH0pO1xyXG5cclxuLy8gICAgIHBsYXllci5zZWVrVG8obmV3UGxheWJhY2tQb3NpdGlvblNlYyk7XHJcbi8vICAgfSk7XHJcblxyXG4vLyAgICQoXCIucGxheWVyX19zcGxhc2hcIikuY2xpY2soKGUpID0+IHtcclxuLy8gICAgIHBsYXllci5wbGF5VmlkZW8oKTtcclxuLy8gICB9KTtcclxuXHJcbi8vICAgJChcIi5wbGF5ZXJfX3ZvbHVtZVwiKS5jbGljaygoZSkgPT4ge1xyXG4vLyAgICAgY29uc3QgdkJhciA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuLy8gICAgIGNvbnN0IHZDbGlja2VkUG9zaXRpb24gPSBlLm9yaWdpbmFsRXZlbnQubGF5ZXJYO1xyXG4vLyAgICAgY29uc3QgbmV3dkJ1dHRvblBvc2l0aW9uUGVyY2VudCA9ICh2Q2xpY2tlZFBvc2l0aW9uIC8gdkJhci53aWR0aCgpKSAqIDEwMDtcclxuXHJcbi8vICAgICAkKFwiLnBsYXllcl9fdm9sdW1lLWJ1dHRvblwiKS5jc3Moe1xyXG4vLyAgICAgICBsZWZ0OiBgJHtuZXd2QnV0dG9uUG9zaXRpb25QZXJjZW50fSVgLFxyXG4vLyAgICAgfSk7XHJcblxyXG4vLyAgICAgcGxheWVyLnNldFZvbHVtZShuZXd2QnV0dG9uUG9zaXRpb25QZXJjZW50KTtcclxuLy8gICB9KTtcclxuLy8gfTtcclxuXHJcbi8vIGNvbnN0IGZvcm1hdFRpbWUgPSAodGltZVNlYykgPT4ge1xyXG4vLyAgIGNvbnN0IHJvdW5kVGltZSA9IE1hdGgucm91bmQodGltZVNlYyk7XHJcblxyXG4vLyAgIGNvbnN0IG1pbnV0ZXMgPSBhZGRaZXJvKE1hdGguZmxvb3Iocm91bmRUaW1lIC8gNjApKTtcclxuLy8gICBjb25zdCBzZWNvbmRzID0gYWRkWmVybyhyb3VuZFRpbWUgLSBtaW51dGVzICogNjApO1xyXG5cclxuLy8gICBmdW5jdGlvbiBhZGRaZXJvKG51bSkge1xyXG4vLyAgICAgcmV0dXJuIG51bSA8IDEwID8gYDAke251bX1gIDogbnVtO1xyXG4vLyAgIH1cclxuXHJcbi8vICAgcmV0dXJuIGAke21pbnV0ZXN9IDogJHtzZWNvbmRzfWA7XHJcbi8vIH07XHJcblxyXG4vLyBjb25zdCBvblBsYXllclJlYWR5ID0gKCkgPT4ge1xyXG4vLyAgIGxldCBpbnRlcnZhbDtcclxuLy8gICBjb25zdCBkdXJhdGlvblNlYyA9IHBsYXllci5nZXREdXJhdGlvbigpO1xyXG5cclxuLy8gICAkKFwiLnBsYXllcl9fZHVyYXRpb24tZXN0aW1hdGVcIikudGV4dChmb3JtYXRUaW1lKGR1cmF0aW9uU2VjKSk7XHJcblxyXG4vLyAgIGlmICh0eXBlb2YgaW50ZXJ2YWwgIT09IFwidW5kZWZpbmVkXCIpIHtcclxuLy8gICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xyXG4vLyAgIH1cclxuXHJcbi8vICAgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbi8vICAgICBjb25zdCBjb21wbGV0ZWRTZWMgPSBwbGF5ZXIuZ2V0Q3VycmVudFRpbWUoKTtcclxuLy8gICAgIGNvbnN0IGNvbXBsZXRlZFBlcmNlbnQgPSAoY29tcGxldGVkU2VjIC8gZHVyYXRpb25TZWMpICogMTAwO1xyXG5cclxuLy8gICAgICQoXCIucGxheWVyX19wbGF5YmFjay1saW5lXCIpLmNzcyh7XHJcbi8vICAgICAgIHdpZHRoOiBgJHtjb21wbGV0ZWRQZXJjZW50fSVgLFxyXG4vLyAgICAgfSk7XHJcbi8vICAgICAkKFwiLnBsYXllcl9fZHVyYXRpb24tY29tcGxldGVkXCIpLnRleHQoZm9ybWF0VGltZShjb21wbGV0ZWRTZWMpKTtcclxuLy8gICB9LCAxMDAwKTtcclxuXHJcbi8vICAgY29uc3Qgdm9sdW1lTnVtYmVyID0gcGxheWVyLmdldFZvbHVtZSgpO1xyXG5cclxuLy8gICAkKFwiLnBsYXllcl9fdm9sdW1lLWJ1dHRvblwiKS5jc3Moe1xyXG4vLyAgICAgbGVmdDogYCR7dm9sdW1lTnVtYmVyfSVgLFxyXG4vLyAgIH0pO1xyXG4vLyB9O1xyXG5cclxuLy8gY29uc3Qgb25QbGF5ZXJTdGF0ZUNoYW5nZSA9IChldmVudCkgPT4ge1xyXG4vLyAgIC8qXHJcbi8vICAgICAgIC0xICjQstC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40LUg0LLQuNC00LXQviDQvdC1INC90LDRh9Cw0YLQvilcclxuLy8gICAgICAgMCAo0LLQvtGB0L/RgNC+0LjQt9Cy0LXQtNC10L3QuNC1INCy0LjQtNC10L4g0LfQsNCy0LXRgNGI0LXQvdC+KVxyXG4vLyAgICAgICAxICjQstC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40LUpXHJcbi8vICAgICAgIDIgKNC/0LDRg9C30LApXHJcbi8vICAgICAgIDMgKNCx0YPRhNC10YDQuNC30LDRhtC40Y8pXHJcbi8vICAgICAgIDUgKNCy0LjQtNC10L4g0L/QvtC00LDRjtGCINGA0LXQv9C70LjQutC4KS5cclxuLy8gICAgICovXHJcbi8vICAgc3dpdGNoIChldmVudC5kYXRhKSB7XHJcbi8vICAgICBjYXNlIDE6XHJcbi8vICAgICAgIHBsYXllckNvbnRhaW5lci5hZGRDbGFzcyhcInBsYXllci0tYWN0aXZlXCIpO1xyXG4vLyAgICAgICBwbGF5ZXJTdGFydC5hZGRDbGFzcyhcInBsYXllcl9fc3RhcnQtLWFjdGl2ZVwiKTtcclxuLy8gICAgICAgYnJlYWs7XHJcblxyXG4vLyAgICAgY2FzZSAyOlxyXG4vLyAgICAgICBwbGF5ZXJDb250YWluZXIucmVtb3ZlQ2xhc3MoXCJwbGF5ZXItLWFjdGl2ZVwiKTtcclxuLy8gICAgICAgcGxheWVyU3RhcnQucmVtb3ZlQ2xhc3MoXCJwbGF5ZXJfX3N0YXJ0LS1hY3RpdmVcIik7XHJcbi8vICAgICAgIGJyZWFrO1xyXG4vLyAgIH1cclxuLy8gfTtcclxuLy8gY29uc3QgcGxheWVyVm9sdW1lSWNvbiA9ICQoXCIucGxheWVyX192b2x1bWUtaWNvblwiKTtcclxuXHJcbi8vICQoXCIucGxheWVyX192b2x1bWUtaWNvblwiKS5jbGljaygoZSkgPT4ge1xyXG4vLyAgIGlmIChwbGF5ZXIuZ2V0Vm9sdW1lKCkgPT0gMCkge1xyXG4vLyAgICAgcGxheWVyLnNldFZvbHVtZShcIjEwMFwiKTtcclxuLy8gICAgIHBsYXllclZvbHVtZUljb24ucmVtb3ZlQ2xhc3MoXCJtdXRlZFwiKTtcclxuLy8gICAgICQoXCIucGxheWVyX192b2x1bWUtYnV0dG9uXCIpLmNzcyh7XHJcbi8vICAgICAgIGxlZnQ6IGAxMDAlYCxcclxuLy8gICAgIH0pO1xyXG4vLyAgIH0gZWxzZSB7XHJcbi8vICAgICBwbGF5ZXIuc2V0Vm9sdW1lKFwiMFwiKTtcclxuLy8gICAgIHBsYXllclZvbHVtZUljb24uYWRkQ2xhc3MoXCJtdXRlZFwiKTtcclxuLy8gICAgICQoXCIucGxheWVyX192b2x1bWUtYnV0dG9uXCIpLmNzcyh7XHJcbi8vICAgICAgIGxlZnQ6IGAwJWAsXHJcbi8vICAgICB9KTtcclxuLy8gICB9XHJcbi8vIH0pO1xyXG5cclxuLy8gZnVuY3Rpb24gb25Zb3VUdWJlSWZyYW1lQVBJUmVhZHkoKSB7XHJcbi8vICAgcGxheWVyID0gbmV3IFlULlBsYXllcihcInl0LXBsYXllclwiLCB7XHJcbi8vICAgICBoZWlnaHQ6IFwicmVtKDM5MilcIixcclxuLy8gICAgIHdpZHRoOiBcInJlbSg2NjIpXCIsXHJcbi8vICAgICB2aWRlb0lkOiBcImhrM0tQYTZ6V3pvXCIsXHJcbi8vICAgICBldmVudHM6IHtcclxuLy8gICAgICAgb25SZWFkeTogb25QbGF5ZXJSZWFkeSxcclxuLy8gICAgICAgb25TdGF0ZUNoYW5nZTogb25QbGF5ZXJTdGF0ZUNoYW5nZSxcclxuLy8gICAgIH0sXHJcbi8vICAgICBwbGF5ZXJWYXJzOiB7XHJcbi8vICAgICAgIGNvbnRyb2xzOiAwLFxyXG4vLyAgICAgICBkaXNhYmxla2I6IDEsXHJcbi8vICAgICAgIHNob3dpbmZvOiAwLFxyXG4vLyAgICAgICByZWw6IDAsXHJcbi8vICAgICAgIGF1dG9wbGF5OiAwLFxyXG4vLyAgICAgICBtb2Rlc3RicmFuZGluZzogMCxcclxuLy8gICAgIH0sXHJcbi8vICAgfSk7XHJcbi8vIH1cclxuLy8gZXZlbnRzSW5pdCgpO1xyXG5cclxuXHJcblxyXG5cclxuY29uc3QgcGxheWVyQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZpZGVvX19wbGF5ZXItaW1nJyk7XHJcbmNvbnN0IHZpZGVvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYXllcicpO1xyXG5jb25zdCBwbGF5ZXJQbGF5QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBsYXllcl9fc3RhcnQnKTtcclxuY29uc3QgZHVyYXRpb25Db250cm9sID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2R1cmF0aW9uTGV2ZWwnKTtcclxuY29uc3Qgc291bmRDb250cm9sID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pY0xldmVsJyk7XHJcbmNvbnN0IHNvdW5kQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvdW5kJyk7XHJcblxyXG5sZXQgaW50ZXJ2YWxJZDtcclxubGV0IHNvdW5kTGV2ZWw7XHJcblxyXG52aWRlby5hZGRFdmVudExpc3RlbmVyKFwibG9hZGVkZGF0YVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgLy8gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uICgpIHtcclxuXHJcblxyXG52aWRlby5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHBsYXlTdG9wKTtcclxuXHJcbmxldCBwbGF5QnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wbGF5Jyk7XHJcblxyXG5mb3IgKGxldCBpID0gMDsgaSA8IHBsYXlCdXR0b25zLmxlbmd0aDsgaSsrKSB7XHJcbiAgcGxheUJ1dHRvbnNbaV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBwbGF5U3RvcCk7XHJcbn1cclxuXHJcbmR1cmF0aW9uQ29udHJvbC5taW4gPSAwO1xyXG5kdXJhdGlvbkNvbnRyb2wudmFsdWUgPSAwO1xyXG5kdXJhdGlvbkNvbnRyb2wubWF4ID0gcGFyc2VJbnQodmlkZW8uZHVyYXRpb24pO1xyXG5cclxuZHVyYXRpb25Db250cm9sLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgc2V0VmlkZW9EdXJhdGlvbik7XHJcblxyXG5zb3VuZENvbnRyb2wubWluID0gMDtcclxuc291bmRDb250cm9sLm1heCA9IDEwO1xyXG5zb3VuZENvbnRyb2wudmFsdWUgPSBzb3VuZENvbnRyb2wubWF4O1xyXG5zb3VuZENvbnRyb2wuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBjaGFuZ2VTb3VuZFZvbHVtZSk7XHJcblxyXG5zb3VuZEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNvdW5kT2YpO1xyXG52aWRlby5hZGRFdmVudExpc3RlbmVyKCdlbmRlZCcsICgpID0+IHtcclxuICBwbGF5ZXJCdG4uY2xhc3NMaXN0LnRvZ2dsZSgndmlkZW9fX3BsYXllci1pbWctLWFjdGl2ZScpO1xyXG4gIHBsYXllclBsYXlCdG4uY2xhc3NMaXN0LnJlbW92ZSgncGxheWVyX19zdGFydC0tYWN0aXZlJyk7XHJcbiAgdmlkZW8uY3VycmVudFRpbWUgPSAwO1xyXG59KTtcclxufSk7XHJcbi8vIH0pO1xyXG5cclxuXHJcbmZ1bmN0aW9uIHBsYXlTdG9wKCkge1xyXG4gIHBsYXllckJ0bi5jbGFzc0xpc3QudG9nZ2xlKCd2aWRlb19fcGxheWVyLWltZy0tYWN0aXZlJyk7XHJcbiAgcGxheWVyUGxheUJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdwbGF5ZXJfX3N0YXJ0LS1hY3RpdmUnKTtcclxuICBpZiAodmlkZW8ucGF1c2VkKSB7XHJcbiAgICB2aWRlby5wbGF5KCk7XHJcbiAgICBpbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwodXBkYXRlRHVyYXRpb24sIDEwMDAgLyA2MCk7XHJcblxyXG4gIH0gZWxzZSB7XHJcbiAgICBjbGVhckludGVydmFsKGludGVydmFsSWQpO1xyXG4gICAgdmlkZW8ucGF1c2UoKTtcclxuXHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRWaWRlb0R1cmF0aW9uKCkge1xyXG4gIHZpZGVvLmN1cnJlbnRUaW1lID0gZHVyYXRpb25Db250cm9sLnZhbHVlO1xyXG4gIHVwZGF0ZUR1cmF0aW9uKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZUR1cmF0aW9uKCkge1xyXG4gIGR1cmF0aW9uQ29udHJvbC52YWx1ZSA9IHZpZGVvLmN1cnJlbnRUaW1lO1xyXG4gIGxldCBzdGVwID0gdmlkZW8uZHVyYXRpb24gLyAxMDA7XHJcbiAgbGV0IHBlcmNlbnQgPSB2aWRlby5jdXJyZW50VGltZSAvIHN0ZXA7XHJcbiAgZHVyYXRpb25Db250cm9sLnN0eWxlLmJhY2tncm91bmQgPSBgbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjRkYwMDAwIDAlLCAjRkYwMDAwICR7cGVyY2VudH0lLCAjNjI2MjYyICR7cGVyY2VudH0lKWA7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNoYW5nZVNvdW5kVm9sdW1lKCkge1xyXG4gIHZpZGVvLnZvbHVtZSA9IHNvdW5kQ29udHJvbC52YWx1ZSAvIDEwO1xyXG4gIGlmICh2aWRlby52b2x1bWUgPT0gMCkge1xyXG4gICAgc291bmRCdG4uY2xhc3NMaXN0LmFkZChcIm11dGVkXCIpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBzb3VuZEJ0bi5jbGFzc0xpc3QucmVtb3ZlKFwibXV0ZWRcIik7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBzb3VuZE9mKCkge1xyXG4gIGlmICh2aWRlby52b2x1bWUgPT0gMCkge1xyXG4gICAgICB2aWRlby52b2x1bWUgPSBzb3VuZExldmVsO1xyXG4gICAgICBzb3VuZENvbnRyb2wudmFsdWUgPSBzb3VuZExldmVsICogMTA7XHJcbiAgICAgIHNvdW5kQnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJtdXRlZFwiKTtcclxuICB9IGVsc2Uge1xyXG5zb3VuZExldmVsID0gdmlkZW8udm9sdW1lO1xyXG52aWRlby52b2x1bWUgPSAwO1xyXG5zb3VuZENvbnRyb2wudmFsdWUgPSAwO1xyXG5zb3VuZEJ0bi5jbGFzc0xpc3QuYWRkKFwibXV0ZWRcIik7XHJcbiAgfVxyXG59IiwiY29uc3QgdmFsaWRhdGVGaWVsZHMgPSAoZm9ybSwgZmllbGRzQXJyYXkpID0+IHtcclxuICBmaWVsZHNBcnJheS5mb3JFYWNoKChmaWVsZCkgPT4ge1xyXG4gICAgZmllbGQucmVtb3ZlQ2xhc3MoXCJpbnB1dC1lcnJvclwiKTtcclxuICAgIGlmIChmaWVsZC52YWwoKS50cmltKCkgPT0gXCJcIikge1xyXG4gICAgICBmaWVsZC5hZGRDbGFzcyhcImlucHV0LWVycm9yXCIpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICBjb25zdCBlcnJvckZpZWxkcyA9IGZvcm0uZmluZChcIi5pbnB1dC1lcnJvclwiKTtcclxuXHJcbiAgcmV0dXJuIGVycm9yRmllbGRzLmxlbmd0aCA9PSAwO1xyXG59O1xyXG5cclxuJChcIi5mb3JtXCIpLnN1Ym1pdCgoZSkgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgY29uc3QgZm9ybSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCBuYW1lID0gZm9ybS5maW5kKFwiW25hbWU9J25hbWUnXVwiKTtcclxuICBjb25zdCBwaG9uZSA9IGZvcm0uZmluZChcIltuYW1lPSdwaG9uZSddXCIpO1xyXG4gIGNvbnN0IGNvbW1lbnQgPSBmb3JtLmZpbmQoXCJbbmFtZT0nY29tbWVudCddXCIpO1xyXG4gIGNvbnN0IHRvID0gZm9ybS5maW5kKFwiW25hbWU9J3RvJ11cIik7XHJcbiAgY29uc3QgbW9kYWwgPSAkKFwiI21vZGFsXCIpO1xyXG4gIGNvbnN0IGNvbnRlbnQgPSBtb2RhbC5maW5kKFwiLm1vZGFsX19jb250ZW50XCIpO1xyXG5cclxuICBtb2RhbC5yZW1vdmVDbGFzcyhcImVycm9yLW1vZGFsXCIpO1xyXG5cclxuICBjb25zdCBpc1ZhbGlkID0gdmFsaWRhdGVGaWVsZHMoZm9ybSwgW25hbWUsIHBob25lLCBjb21tZW50LCB0b10pO1xyXG5cclxuICBpZiAoaXNWYWxpZCkge1xyXG4gICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCdsb2NrZWQnKTtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSAkLmFqYXgoe1xyXG4gICAgICB1cmw6IFwiaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsXCIsXHJcbiAgICAgIG1ldGhvZDogXCJwb3N0XCIsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICBuYW1lOiBuYW1lLnZhbCgpLFxyXG4gICAgICAgIHBob25lOiBwaG9uZS52YWwoKSxcclxuICAgICAgICBjb21tZW50OiBjb21tZW50LnZhbCgpLFxyXG4gICAgICAgIHRvOiB0by52YWwoKSxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIHJlcXVlc3QuZG9uZSgoZGF0YSkgPT4ge1xyXG4gICAgICBjb250ZW50LnRleHQoZGF0YS5tZXNzYWdlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJlcXVlc3QuZmFpbCgoZGF0YSkgPT4ge1xyXG4gICAgICBjb25zdCBtZXNzYWdlID0gZGF0YS5yZXNwb25zZUpTT04ubWVzc2FnZTtcclxuICAgICAgY29udGVudC50ZXh0KG1lc3NhZ2UpO1xyXG4gICAgICBtb2RhbC5hZGRDbGFzcyhcImVycm9yLW1vZGFsXCIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmVxdWVzdC5hbHdheXMoKCkgPT4ge1xyXG4gICAgICAkLmZhbmN5Ym94Lm9wZW4oe1xyXG4gICAgICAgIHNyYzogXCIjbW9kYWxcIixcclxuICAgICAgICB0eXBlOiBcImlubGluZVwiLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4kKFwiLmFwcC1jbG9zZS1tb2RhbFwiKS5jbGljaygoZSkgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdsb2NrZWQnKTtcclxuXHJcbiAgJC5mYW5jeWJveC5jbG9zZSgpO1xyXG59KTtcclxuIiwiY29uc3Qgc2VjdGlvbnMgPSAkKFwic2VjdGlvblwiKTtcclxuY29uc3QgZGlzcGxheSA9ICQoXCIubWFpbmNvbnRlbnRcIik7XHJcbmNvbnN0IHNpZGVNZW51ID0gJChcIi5maXhlZC1tZW51XCIpO1xyXG5jb25zdCBtZW51SXRlbXMgPSBzaWRlTWVudS5maW5kKFwiZml4ZWQtbWVudV9faXRlbVwiKTtcclxuXHJcbmNvbnN0IG1vYmlsZURldGVjdCA9IG5ldyBNb2JpbGVEZXRlY3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpO1xyXG5jb25zdCBpc01vYmlsZSA9IG1vYmlsZURldGVjdC5tb2JpbGUoKTtcclxuXHJcbmxldCBpblNjcm9sbCA9IGZhbHNlO1xyXG5cclxuc2VjdGlvbnMuZmlyc3QoKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcclxuXHJcbmNvbnN0IGNvdW50U2VjdGlvblBvc2l0aW9uID0gKHNlY3Rpb25FcSkgPT4ge1xyXG5cclxuICAgIGNvbnN0IHBvc2l0aW9uID0gc2VjdGlvbkVxICogLTEwMDtcclxuXHJcbiAgICBpZiAoaXNOYU4ocG9zaXRpb24pKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcItC/0LXRgNC10LTQsNC90L4g0L3QtSDQstC10YDQvdC+0LUg0LfQvdCw0YfQtdC90LjQtSDQsiBjb3VudFNlY3Rpb25Qb3NpdGlvblwiKTtcclxuICAgICAgICByZXR1cm4gMDtcclxuICAgIH1cclxuICAgIHJldHVybiBwb3NpdGlvbjtcclxufVxyXG5cclxuY29uc3QgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0gPSAoaXRlbXMsIGl0ZW1FcSwgYWN0aXZlQ2xhc3MpID0+IHtcclxuICAgIGl0ZW1zLmVxKGl0ZW1FcSkuYWRkQ2xhc3MoYWN0aXZlQ2xhc3MpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoYWN0aXZlQ2xhc3MpO1xyXG59XHJcblxyXG5jb25zdCBwZXJmb3JtVHJhbnNpdGlvbiA9IChzZWN0aW9uRXEpID0+IHtcclxuXHJcbiAgICBpZiAoaW5TY3JvbGwgfHwgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuY29udGFpbnMoJ2xvY2tlZCcpKSByZXR1cm47XHJcblxyXG4gICAgY29uc3QgdHJhbnNpdGlvbk92ZXIgPSAxMDAwO1xyXG4gICAgY29uc3QgbW91c2VJbmVydGlhT3ZlciA9IDMwMDtcclxuICAgIGluU2Nyb2xsID0gdHJ1ZTtcclxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IGNvdW50U2VjdGlvblBvc2l0aW9uKHNlY3Rpb25FcSk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgZGlzcGxheS5jc3Moe1xyXG4gICAgICAgICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGVZKCR7cG9zaXRpb259JSlgLFxyXG4gICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0oc2VjdGlvbnMsIHNlY3Rpb25FcSwgXCJhY3RpdmVcIik7XHJcbiAgICAgICAgc2VjdGlvbnMuZXEoc2VjdGlvbkVxKS5hZGRDbGFzcyhcImFjdGl2ZVwiKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xyXG5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIGluU2Nyb2xsID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtKG1lbnVJdGVtcywgc2VjdGlvbkVxLCBcImZpeGVkLW1lbnVfX2l0ZW0tLWFjdGl2ZVwiKTtcclxuXHJcblxyXG4gICAgICAgIHNpZGVNZW51XHJcbiAgICAgICAgLmZpbmQoXCIuZml4ZWQtbWVudV9faXRlbVwiKVxyXG4gICAgICAgIC5lcShzZWN0aW9uRXEpXHJcbiAgICAgICAgLmFkZENsYXNzKFwiZml4ZWQtbWVudV9faXRlbS0tYWN0aXZlXCIpXHJcbiAgICAgICAgLnNpYmxpbmdzKClcclxuICAgICAgICAucmVtb3ZlQ2xhc3MoXCJmaXhlZC1tZW51X19pdGVtLS1hY3RpdmVcIik7XHJcbiAgICB9LCB0cmFuc2l0aW9uT3ZlciArIG1vdXNlSW5lcnRpYU92ZXIpO1xyXG4gICAgXHJcbiAgXHJcbn07XHJcblxyXG5jb25zdCB2aWV3cG9ydFNjcm9sbGVyID0gKCkgPT4ge1xyXG4gICAgY29uc3QgYWN0aXZlU2VjdGlvbiA9IHNlY3Rpb25zLmZpbHRlcihcIi5hY3RpdmVcIik7XHJcbiAgICBjb25zdCBuZXh0U2VjdGlvbiA9IGFjdGl2ZVNlY3Rpb24ubmV4dCgpO1xyXG4gICAgY29uc3QgcHJldlNlY3Rpb24gPSBhY3RpdmVTZWN0aW9uLnByZXYoKTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIG5leHQoKSB7XHJcbiAgICAgICAgICAgIGlmKG5leHRTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgcGVyZm9ybVRyYW5zaXRpb24obmV4dFNlY3Rpb24uaW5kZXgoKSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcHJldigpIHtcclxuICAgICAgICAgICAgaWYocHJldlNlY3Rpb24ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBwZXJmb3JtVHJhbnNpdGlvbihwcmV2U2VjdGlvbi5pbmRleCgpKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgIH1cclxuXHJcblxyXG5cclxuXHJcbn07XHJcblxyXG4kKHdpbmRvdykub24oXCJ3aGVlbFwiLCBlPT4ge1xyXG5jb25zdCBkZWx0YVkgPSBlLm9yaWdpbmFsRXZlbnQuZGVsdGFZO1xyXG5jb25zdCBzY3JvbGxlciA9IHZpZXdwb3J0U2Nyb2xsZXIoKTtcclxuXHJcbmlmIChkZWx0YVkgPiAwKSB7XHJcbiAgICBzY3JvbGxlci5uZXh0KCk7XHJcbi8vIHNjcm9sbFZpZXdwb3J0KFwibmV4dFwiKTtcclxufVxyXG5pZiAoZGVsdGFZIDwgMCkge1xyXG4gICAgc2Nyb2xsZXIucHJldigpO1xyXG4gICAgLy8gc2Nyb2xsVmlld3BvcnQoXCJwcmV2XCIpO1xyXG59XHJcbn0pO1xyXG5cclxuJCh3aW5kb3cpLm9uKFwia2V5ZG93blwiLCAoZSkgPT4ge1xyXG5cclxuICAgIGNvbnN0IHRhZ05hbWUgPSBlLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICBjb25zdCB1c2VyVHlwaW5nSW5JbnB1dHMgPSB0YWdOYW1lID09IFwiaW5wdXRcIiB8fCB0YWdOYW1lID09IFwidGV4dGFyZWFcIiA7XHJcbiAgICBjb25zdCBzY3JvbGxlciA9IHZpZXdwb3J0U2Nyb2xsZXIoKTtcclxuXHJcbiAgICBpZih1c2VyVHlwaW5nSW5JbnB1dHMpIHJldHVybjtcclxuXHJcbiAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XHJcbiAgICBjYXNlIDM4OlxyXG4gICAgICAgIHNjcm9sbGVyLnByZXYoKTtcclxuICAgICAgICBicmVhaztcclxuICAgXHJcbiAgICAgICAgY2FzZSA0MDpcclxuICAgICAgICAgICAgc2Nyb2xsZXIubmV4dCgpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIFxyXG4gICB9IFxyXG5cclxufSk7XHJcblxyXG4kKFwiLndyYXBwZXJcIikub24oXCJ0b3VjaG1vdmVcIiwgZSA9PiBlLnByZXZlbnREZWZhdWx0KCkpO1xyXG5cclxuJChcIltkYXRhLXNjcm9sbC10b11cIikuY2xpY2soZT0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgIGNvbnN0IHRhcmdldCA9ICR0aGlzLmF0dHIoXCJkYXRhLXNjcm9sbC10b1wiKTtcclxuICAgIGNvbnN0IHJlcVNlY3Rpb24gPSAkKGBbZGF0YS1zZWN0aW9uLWlkPSR7dGFyZ2V0fV1gKTtcclxuXHJcbiAgICBwZXJmb3JtVHJhbnNpdGlvbihyZXFTZWN0aW9uLmluZGV4KCkpO1xyXG59KTtcclxuXHJcbmlmIChpc01vYmlsZSkge1xyXG4vL2h0dHBzOi8vZ2l0aHViLmNvbS9tYXR0YnJ5c29uL1RvdWNoU3dpcGUtSnF1ZXJ5LVBsdWdpblxyXG4kKFwiYm9keVwiKS5zd2lwZSgge1xyXG4gICAgc3dpcGU6IGZ1bmN0aW9uIChldmVudCwgZGlyZWN0aW9uLCkge1xyXG4gICAgICAgIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG4gICAgICAgIGxldCBzY3JvbGxEaXJlY3Rpb24gPSBcIlwiO1xyXG5cclxuICAgICAgICBpZiAoZGlyZWN0aW9uID09IFwidXBcIikgc2Nyb2xsRGlyZWN0aW9uID0gXCJuZXh0XCI7IFxyXG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT0gXCJkb3duXCIpIHNjcm9sbERpcmVjdGlvbiA9IFwicHJldlwiOyBcclxuXHJcblxyXG4gICAgICBpZiAoc2Nyb2xsRGlyZWN0aW9uKSB7XHJcbiAgICAgICAgc2Nyb2xsZXJbc2Nyb2xsRGlyZWN0aW9uXSgpO1xyXG4gICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcbiAgfSk7XHJcbn0iLCJjb25zdCBsaXN0ID0gJChcIi5wcm9kdWN0cy1tZW51X19saXN0XCIpO1xyXG5cclxubGlzdC5vbihcImNsaWNrXCIsIFwiLnByb2R1Y3RcIiwgZnVuY3Rpb24gKGUpIHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgJCh0aGlzKS5zaWJsaW5ncyhcImxpXCIpLnJlbW92ZUNsYXNzKFwicHJvZHVjdC0tYWN0aXZlXCIpO1xyXG4gICQodGhpcykudG9nZ2xlQ2xhc3MoXCJwcm9kdWN0LS1hY3RpdmVcIik7XHJcbiAgbGV0ICRjb250ZW50ID0gJCh0aGlzKS5maW5kKFwiLnByb2R1Y3RfX2NvbnRlbnRcIik7XHJcblxyXG4gIGxldCBjdXJXaWR0aCA9IDA7XHJcbiAgbGV0IG5ld1dpZHRoID0gNTI0O1xyXG5cclxuICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPD0gNzY4ICYmICQod2luZG93KS53aWR0aCgpID4gNDgwKSB7XHJcbiAgICBjdXJXaWR0aCA9ICQoXCIucHJvZHVjdF9fdGl0bGVcIikud2lkdGgoKSAqICQoXCIucHJvZHVjdF9fdGl0bGVcIikubGVuZ3RoO1xyXG4gICAgbmV3V2lkdGggPSAkKHdpbmRvdykud2lkdGgoKSAtIGN1cldpZHRoO1xyXG4gIH1cclxuXHJcbiAgaWYgKCQod2luZG93KS53aWR0aCgpIDw9IDQ4MCkge1xyXG4gICAgY3VyV2lkdGggPSAkKFwiLnByb2R1Y3RfX3RpdGxlXCIpLndpZHRoKCk7XHJcbiAgICBuZXdXaWR0aCA9ICQod2luZG93KS53aWR0aCgpIC0gY3VyV2lkdGg7XHJcbiAgfVxyXG5cclxuICBsaXN0LmZpbmQoXCIucHJvZHVjdF9fY29udGVudFwiKS5jc3MoXCJ3aWR0aFwiLCAwKTtcclxuXHJcbiAgaWYgKCQodGhpcykuaGFzQ2xhc3MoXCJwcm9kdWN0LS1hY3RpdmVcIikpIHtcclxuICAgICRjb250ZW50LmNzcyhcIndpZHRoXCIsIGAke25ld1dpZHRofXB4YCk7XHJcbiAgfVxyXG59KTtcclxuIiwiY29uc3Qgc2xpZGVyID0gJChcIi5zaG9wX19saXN0XCIpLmJ4U2xpZGVyKHtcclxuICBwYWdlcjogZmFsc2UsXHJcbiAgY29udHJvbHM6IGZhbHNlLFxyXG59KTtcclxuXHJcbiQoXCIuc2hvcF9fYnRuX2xlZnRcIikuY2xpY2soKGUpID0+IHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gIHNsaWRlci5nb1RvUHJldlNsaWRlKCk7XHJcbn0pO1xyXG4kKFwiLnNob3BfX2J0bl9yaWdodFwiKS5jbGljaygoZSkgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgc2xpZGVyLmdvVG9OZXh0U2xpZGUoKTtcclxufSk7XHJcbiIsImNvbnN0IGZpbmRCbG9ja0J5QWxpYXMgPSAoYWxpYXMpID0+IHtcclxuICByZXR1cm4gJChcIi5yZXZpZXdzX19pdGVtXCIpLmZpbHRlcigobmR4LCBpdGVtKSA9PiB7XHJcbiAgICByZXR1cm4gJChpdGVtKS5hdHRyKFwiZGF0YS1saW5rZWQtd2l0aFwiKSA9PSBhbGlhcztcclxuICB9KTtcclxufTtcclxuXHJcbiQoXCIuaW50ZXJhY3RpdmUtYXZhdGFyX19saW5rXCIpLmNsaWNrKChlKSA9PiB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCB0YXJnZXQgPSAkdGhpcy5hdHRyKFwiZGF0YS1vcGVuXCIpO1xyXG4gIGNvbnN0IGl0ZW1Ub1Nob3cgPSBmaW5kQmxvY2tCeUFsaWFzKHRhcmdldCk7XHJcbiAgY29uc3QgY3VySXRlbSA9ICR0aGlzLmNsb3Nlc3QoXCIuaW50ZXJhY3RpdmUtYXZhdGFyXCIpO1xyXG5cclxuICBpdGVtVG9TaG93XHJcbiAgICAuYWRkQ2xhc3MoXCJyZXZpZXdzX19pdGVtLS1hY3RpdmVcIilcclxuICAgIC5zaWJsaW5ncygpXHJcbiAgICAucmVtb3ZlQ2xhc3MoXCJyZXZpZXdzX19pdGVtLS1hY3RpdmVcIik7XHJcblxyXG4gIGN1ckl0ZW1cclxuICAgIC5hZGRDbGFzcyhcImludGVyYWN0aXZlLWF2YXRhci0tYWN0aXZlXCIpXHJcbiAgICAuc2libGluZ3MoKVxyXG4gICAgLnJlbW92ZUNsYXNzKFwiaW50ZXJhY3RpdmUtYXZhdGFyLS1hY3RpdmVcIik7XHJcbn0pO1xyXG4iLCJjb25zdCBvcGVuSXRlbSA9IChpdGVtKSA9PiB7XHJcbiAgY29uc3QgY29udGFpbmVyID0gaXRlbS5jbG9zZXN0KFwiLnNsaWRlcl9faXRlbVwiKTtcclxuICBjb25zdCBjb250ZW50QmxvY2sgPSBjb250YWluZXIuZmluZChcIi5zbGlkZXJfX2Rlc2NyaXB0aW9uXCIpO1xyXG4gIGNvbnN0IHRleHRCbG9jayA9IGNvbnRlbnRCbG9jay5maW5kKFwiLnNsaWRlcl9fZGVzY3JpcHRpb24tLXdyYXBcIik7XHJcbiAgY29uc3QgcmVxSGVpZ2h0ID0gdGV4dEJsb2NrLmhlaWdodCgpO1xyXG5cclxuICBjb250YWluZXIuYWRkQ2xhc3MoXCIuc2xpZGVyX19pdGVtLS1hY3RpdmVcIik7XHJcbiAgY29udGVudEJsb2NrLmhlaWdodChyZXFIZWlnaHQpO1xyXG59O1xyXG5cclxuY29uc3QgY2xvc2VFdmVyeUl0ZW0gPSAoY29udGFpbmVyKSA9PiB7XHJcbiAgY29uc3QgaXRlbXMgPSBjb250YWluZXIuZmluZChcIi5zbGlkZXJfX2Rlc2NyaXB0aW9uXCIpO1xyXG4gIGNvbnN0IGl0ZW1Db250YWluZXIgPSBjb250YWluZXIuZmluZChcIi5zbGlkZXJfX2l0ZW1cIik7XHJcblxyXG4gIGl0ZW1Db250YWluZXIucmVtb3ZlQ2xhc3MoXCIuc2xpZGVyX19pdGVtLS1hY3RpdmVcIik7XHJcbiAgaXRlbXMuaGVpZ2h0KDApO1xyXG59O1xyXG5cclxuJChcIi5zbGlkZXJfX25hbWVcIikuY2xpY2soKGUpID0+IHtcclxuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCBjb250YWluZXIgPSAkdGhpcy5jbG9zZXN0KFwiLnNsaWRlcl9fbGlzdFwiKTtcclxuICBjb25zdCBlbGVtQ29udGFpbmVyID0gJHRoaXMuY2xvc2VzdChcIi5zbGlkZXJfX2l0ZW1cIik7XHJcbiAgaWYgKGVsZW1Db250YWluZXIuaGFzQ2xhc3MoXCIuc2xpZGVyX19pdGVtLS1hY3RpdmVcIikpIHtcclxuICAgIGNsb3NlRXZlcnlJdGVtKGNvbnRhaW5lcik7XHJcbiAgfSBlbHNlIHtcclxuICAgIGNsb3NlRXZlcnlJdGVtKGNvbnRhaW5lcik7XHJcbiAgICBvcGVuSXRlbSgkdGhpcyk7XHJcbiAgfVxyXG59KTtcclxuIl19
