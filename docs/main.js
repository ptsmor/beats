"use strict";for(var myMap,intervalId,soundLevel,button=document.querySelector("#hamburger__container"),menu=document.querySelector("#fullscreen-menu"),hamburger=document.querySelector("#hamburger"),body=document.querySelector("body"),toggleMenu=function(e){e.preventDefault(),button.classList.toggle("hamburger__container--active"),hamburger.classList.toggle("hamburger--active"),menu.classList.toggle("fullscreen-menu--open"),body.classList.toggle("locked")},init=(button.addEventListener("click",toggleMenu),$(".fullscreen-menu__link").on("click",toggleMenu),function(){myMap=new ymaps.Map("map",{center:[55.752137,37.589335],zoom:13,controls:[]});for(var e=[[55.756012,37.604021],[55.75092,37.615746],[55.746988,37.591715],[55.744078,37.591413]],t=new ymaps.GeoObjectCollection({},{draggable:!1,iconLayout:"default#image",iconImageHref:"./img/marker8.png",iconImageSize:[46,57],iconImageOffset:[-35,-52]}),n=0;n<e.length;n++)t.add(new ymaps.Placemark(e[n]));myMap.geoObjects.add(t),myMap.behaviors.disable("scrollZoom")}),validateFields=(ymaps.ready(init),function(e,t){return t.forEach(function(e){e.removeClass("input-error"),""==e.val().trim()&&e.addClass("input-error")}),0==e.find(".input-error").length}),sections=($(".form").submit(function(e){e.preventDefault();var e=$(e.currentTarget),t=e.find("[name='name']"),n=e.find("[name='phone']"),o=e.find("[name='comment']"),i=e.find("[name='to']"),a=$("#modal"),r=a.find(".modal__content");a.removeClass("error-modal"),validateFields(e,[t,n,o,i])&&(document.body.classList.add("locked"),(e=$.ajax({url:"https://webdev-api.loftschool.com/sendmail",method:"post",data:{name:t.val(),phone:n.val(),comment:o.val(),to:i.val()}})).done(function(e){r.text(e.message)}),e.fail(function(e){e=e.responseJSON.message;r.text(e),a.addClass("error-modal")}),e.always(function(){$.fancybox.open({src:"#modal",type:"inline"})}))}),$(".app-close-modal").click(function(e){e.preventDefault(),document.body.classList.remove("locked"),$.fancybox.close()}),$("section")),display=$(".maincontent"),sideMenu=$(".fixed-menu"),menuItems=sideMenu.find("fixed-menu__item"),mobileDetect=new MobileDetect(window.navigator.userAgent),isMobile=mobileDetect.mobile(),inScroll=!1,countSectionPosition=(sections.first().addClass("active"),function(e){e*=-100;return isNaN(e)?(console.error("передано не верное значение в countSectionPosition"),0):e}),resetActiveClassForItem=function(e,t,n){e.eq(t).addClass(n).siblings().removeClass(n)},performTransition=function(e){var t;inScroll||document.body.classList.contains("locked")||(inScroll=!0,t=countSectionPosition(e),display.css({transform:"translateY(".concat(t,"%)")}),resetActiveClassForItem(sections,e,"active"),sections.eq(e).addClass("active").siblings().removeClass("active"),setTimeout(function(){inScroll=!1,resetActiveClassForItem(menuItems,e,"fixed-menu__item--active"),sideMenu.find(".fixed-menu__item").eq(e).addClass("fixed-menu__item--active").siblings().removeClass("fixed-menu__item--active")},1300))},viewportScroller=function(){var e=sections.filter(".active"),t=e.next(),n=e.prev();return{next:function(){t.length&&performTransition(t.index())},prev:function(){n.length&&performTransition(n.index())}}},playerBtn=($(window).on("wheel",function(e){var e=e.originalEvent.deltaY,t=viewportScroller();0<e&&t.next(),e<0&&t.prev()}),$(window).on("keydown",function(e){var t=e.target.tagName.toLowerCase(),t="input"==t||"textarea"==t,n=viewportScroller();if(!t)switch(e.keyCode){case 38:n.prev();break;case 40:n.next()}}),$(".wrapper").on("touchmove",function(e){return e.preventDefault()}),$("[data-scroll-to]").click(function(e){e.preventDefault();e=$(e.currentTarget).attr("data-scroll-to"),e=$("[data-section-id=".concat(e,"]"));performTransition(e.index())}),isMobile&&$("body").swipe({swipe:function(e,t){var n=viewportScroller(),t="down"==t?"prev":"up"==t?"next":"";t&&n[t]()}}),document.querySelector(".video__player-img")),video=document.getElementById("player"),playerPlayBtn=document.querySelector(".player__start"),durationControl=document.getElementById("durationLevel"),soundControl=document.getElementById("micLevel"),soundBtn=document.getElementById("sound"),playButtons=(video.addEventListener("click",playStop),document.querySelectorAll(".play")),i=0;i<playButtons.length;i++)playButtons[i].addEventListener("click",playStop);function playStop(){playerBtn.classList.toggle("video__player-img--active"),playerPlayBtn.classList.toggle("player__start--active"),video.paused?(video.play(),intervalId=setInterval(updateDuration,1e3/60)):(clearInterval(intervalId),video.pause())}function setVideoDuration(){video.currentTime=durationControl.value,updateDuration()}function updateDuration(){durationControl.value=video.currentTime;var e=video.duration/100,e=video.currentTime/e;durationControl.style.background="linear-gradient(90deg, #FF0000 0%, #FF0000 ".concat(e,"%, #626262 ").concat(e,"%)")}function changeSoundVolume(){video.volume=soundControl.value/10,0==video.volume?soundBtn.classList.add("muted"):soundBtn.classList.remove("muted")}function soundOf(){0==video.volume?(video.volume=soundLevel,soundControl.value=10*soundLevel,soundBtn.classList.remove("muted")):(soundLevel=video.volume,video.volume=0,soundControl.value=0,soundBtn.classList.add("muted"))}durationControl.min=0,durationControl.value=0,durationControl.max=video.duration,durationControl.addEventListener("input",setVideoDuration),soundControl.min=0,soundControl.max=10,soundControl.value=soundControl.max,soundControl.addEventListener("input",changeSoundVolume),soundBtn.addEventListener("click",soundOf),video.addEventListener("ended",function(){playerBtn.classList.toggle("video__player-img--active"),playerPlayBtn.classList.remove("player__start--active"),video.currentTime=0});var list=$(".products-menu__list"),slider=(list.on("click",".product",function(e){e.preventDefault(),$(this).siblings("li").removeClass("product--active"),$(this).toggleClass("product--active");var e=$(this).find(".product__content"),t=0,n=524;$(window).width()<=768&&480<$(window).width()&&(t=$(".product__title").width()*$(".product__title").length,n=$(window).width()-t),$(window).width()<=480&&(t=$(".product__title").width(),n=$(window).width()-t),list.find(".product__content").css("width",0),$(this).hasClass("product--active")&&e.css("width","".concat(n,"px"))}),$(".shop__list").bxSlider({pager:!1,controls:!1})),findBlockByAlias=($(".shop__btn_left").click(function(e){e.preventDefault(),slider.goToPrevSlide()}),$(".shop__btn_right").click(function(e){e.preventDefault(),slider.goToNextSlide()}),function(n){return $(".reviews__item").filter(function(e,t){return $(t).attr("data-linked-with")==n})}),openItem=($(".interactive-avatar__link").click(function(e){e.preventDefault();var e=$(e.currentTarget),t=e.attr("data-open"),t=findBlockByAlias(t),e=e.closest(".interactive-avatar");t.addClass("reviews__item--active").siblings().removeClass("reviews__item--active"),e.addClass("interactive-avatar--active").siblings().removeClass("interactive-avatar--active")}),function(e){var e=e.closest(".slider__item"),t=e.find(".slider__description"),n=t.find(".slider__description--wrap").height();e.addClass(".slider__item--active"),t.height(n)}),closeEveryItem=function(e){var t=e.find(".slider__description");e.find(".slider__item").removeClass(".slider__item--active"),t.height(0)};$(".slider__name").click(function(e){var e=$(e.currentTarget),t=e.closest(".slider__list");e.closest(".slider__item").hasClass(".slider__item--active")?closeEveryItem(t):(closeEveryItem(t),openItem(e))});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBsYXllci5qcyIsIm1haW4uanMiLCJtYXAuanMiLCJtb2RhbC5qcyIsIm9wcy5qcyIsInByb2R1Y3RzLmpzIiwic2hvcHNsaWRlLmpzIiwidGFicy5qcyIsInRlYW0uanMiXSwibmFtZXMiOlsibXlNYXAiLCJpbnRlcnZhbElkIiwic291bmRMZXZlbCIsImJ1dHRvbiIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIm1lbnUiLCJoYW1idXJnZXIiLCJib2R5IiwidG9nZ2xlTWVudSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImNsYXNzTGlzdCIsInRvZ2dsZSIsImluaXQiLCJhZGRFdmVudExpc3RlbmVyIiwiJCIsIm9uIiwieW1hcHMiLCJNYXAiLCJjZW50ZXIiLCJ6b29tIiwiY29udHJvbHMiLCJjb29yZHMiLCJteUNvbGxlY3Rpb24iLCJHZW9PYmplY3RDb2xsZWN0aW9uIiwiZHJhZ2dhYmxlIiwiaWNvbkxheW91dCIsImljb25JbWFnZUhyZWYiLCJpY29uSW1hZ2VTaXplIiwiaWNvbkltYWdlT2Zmc2V0IiwiaSIsImxlbmd0aCIsImFkZCIsIlBsYWNlbWFyayIsImdlb09iamVjdHMiLCJiZWhhdmlvcnMiLCJkaXNhYmxlIiwidmFsaWRhdGVGaWVsZHMiLCJyZWFkeSIsImZvcm0iLCJmaWVsZHNBcnJheSIsImZvckVhY2giLCJmaWVsZCIsInJlbW92ZUNsYXNzIiwidmFsIiwidHJpbSIsImFkZENsYXNzIiwiZmluZCIsInNlY3Rpb25zIiwic3VibWl0IiwiY3VycmVudFRhcmdldCIsIm5hbWUiLCJwaG9uZSIsImNvbW1lbnQiLCJ0byIsIm1vZGFsIiwiY29udGVudCIsInJlcXVlc3QiLCJhamF4IiwidXJsIiwibWV0aG9kIiwiZGF0YSIsImRvbmUiLCJ0ZXh0IiwibWVzc2FnZSIsImZhaWwiLCJyZXNwb25zZUpTT04iLCJhbHdheXMiLCJmYW5jeWJveCIsIm9wZW4iLCJzcmMiLCJ0eXBlIiwiY2xpY2siLCJyZW1vdmUiLCJjbG9zZSIsImRpc3BsYXkiLCJzaWRlTWVudSIsIm1lbnVJdGVtcyIsIm1vYmlsZURldGVjdCIsIk1vYmlsZURldGVjdCIsIndpbmRvdyIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsImlzTW9iaWxlIiwibW9iaWxlIiwiaW5TY3JvbGwiLCJjb3VudFNlY3Rpb25Qb3NpdGlvbiIsImZpcnN0Iiwic2VjdGlvbkVxIiwicG9zaXRpb24iLCJpc05hTiIsImNvbnNvbGUiLCJlcnJvciIsInJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtIiwiaXRlbXMiLCJpdGVtRXEiLCJhY3RpdmVDbGFzcyIsImVxIiwic2libGluZ3MiLCJwZXJmb3JtVHJhbnNpdGlvbiIsImNvbnRhaW5zIiwiY3NzIiwidHJhbnNmb3JtIiwiY29uY2F0Iiwic2V0VGltZW91dCIsInRyYW5zaXRpb25PdmVyIiwidmlld3BvcnRTY3JvbGxlciIsImFjdGl2ZVNlY3Rpb24iLCJmaWx0ZXIiLCJuZXh0U2VjdGlvbiIsIm5leHQiLCJwcmV2U2VjdGlvbiIsInByZXYiLCJpbmRleCIsInBsYXllckJ0biIsImRlbHRhWSIsIm9yaWdpbmFsRXZlbnQiLCJzY3JvbGxlciIsInRhZ05hbWUiLCJ0YXJnZXQiLCJ0b0xvd2VyQ2FzZSIsInVzZXJUeXBpbmdJbklucHV0cyIsImtleUNvZGUiLCJhdHRyIiwicmVxU2VjdGlvbiIsInN3aXBlIiwiZXZlbnQiLCJkaXJlY3Rpb24iLCJzY3JvbGxEaXJlY3Rpb24iLCJ2aWRlbyIsImdldEVsZW1lbnRCeUlkIiwicGxheWVyUGxheUJ0biIsImR1cmF0aW9uQ29udHJvbCIsInNvdW5kQ29udHJvbCIsInNvdW5kQnRuIiwicGxheUJ1dHRvbnMiLCJwbGF5U3RvcCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJwYXVzZWQiLCJwbGF5Iiwic2V0SW50ZXJ2YWwiLCJ1cGRhdGVEdXJhdGlvbiIsImNsZWFySW50ZXJ2YWwiLCJwYXVzZSIsInNldFZpZGVvRHVyYXRpb24iLCJjdXJyZW50VGltZSIsInZhbHVlIiwic3RlcCIsImR1cmF0aW9uIiwicGVyY2VudCIsInN0eWxlIiwiYmFja2dyb3VuZCIsImNoYW5nZVNvdW5kVm9sdW1lIiwidm9sdW1lIiwic291bmRPZiIsIm1pbiIsIm1heCIsImxpc3QiLCJzbGlkZXIiLCJ0aGlzIiwidG9nZ2xlQ2xhc3MiLCIkY29udGVudCIsImN1cldpZHRoIiwibmV3V2lkdGgiLCJ3aWR0aCIsImhhc0NsYXNzIiwiYnhTbGlkZXIiLCJwYWdlciIsImZpbmRCbG9ja0J5QWxpYXMiLCJnb1RvUHJldlNsaWRlIiwiZ29Ub05leHRTbGlkZSIsImFsaWFzIiwibmR4IiwiaXRlbSIsIm9wZW5JdGVtIiwiJHRoaXMiLCJpdGVtVG9TaG93IiwiY3VySXRlbSIsImNsb3Nlc3QiLCJjb250YWluZXIiLCJjb250ZW50QmxvY2siLCJyZXFIZWlnaHQiLCJoZWlnaHQiLCJjbG9zZUV2ZXJ5SXRlbSJdLCJtYXBwaW5ncyI6ImFBb0tBLElDcEtBLElDQUFBLE1GNEpBQyxXQUNBQyxXQzdKQUMsT0FBQUMsU0FBQUMsY0FBQSx5QkFDQUMsS0FBQUYsU0FBQUMsY0FBQSxvQkFEQUUsVUFBQUgsU0FBQUMsY0FBQSxjQUNBRyxLQUFBSixTQUFBQyxjQUFBLFFBc0JBSSxXQUFBLFNBQUFDLEdBQ0FBLEVBQUFDLGlCQUNBUixPQUFBUyxVQUFBQyxPQUFBLGdDQUNBTixVQUFBSyxVQUFBQyxPQUFBLHFCQUNBUCxLQUFBTSxVQUFBQyxPQUFBLHlCQUVBTCxLQUFBSSxVQUFBQyxPQUFBLFdDNUJBQyxNRGlDQVgsT0FBQVksaUJBQUEsUUFBQU4sWUNsQ0FPLEVBQUEsMEJBQUFDLEdBQUEsUUFBQVIsWUFDQSxXQUNBVCxNQUFBLElBQUFrQixNQUFBQyxJQUFBLE1BQUEsQ0FDQUMsT0FBQSxDQUFBLFVBQUEsV0FDQUMsS0FBQSxHQUNBQyxTQUFBLEtBb0JBLElBakJBLElBQUFDLEVBQUEsQ0FDQSxDQUFBLFVBQUEsV0FDQSxDQUFBLFNBQUEsV0FDQSxDQUFBLFVBQUEsV0FDQSxDQUFBLFVBQUEsWUFFQUMsRUFBQSxJQUFBTixNQUFBTyxvQkFDQSxHQUNBLENBQ0FD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L0QsR0FDQUEsRUFBQUMsaUJBRUFvSixPQUFBWSxrQkNiQSxTQUFBQyxHQUNBLE9BQUE1SixFQUFBLGtCQUFBNkYsT0FBQSxTQUFBZ0UsRUFBQUMsR0FDQSxPQUFBOUosRUFBQThKLEdBQUFsRCxLQUFBLHFCQUFBZ0QsTUNGQUcsVURNQS9KLEVBQUEsNkJBQUF5RCxNQUFBLFNBQUEvRCxHQUNBQSxFQUFBQyxpQkFFQSxJQUFBcUssRUFBQWhLLEVBQUFOLEVBQUF5QyxlQUNBcUUsRUFBQXdELEVBQUFwRCxLQUFBLGFBQ0FxRCxFQUFBUixpQkFBQWpELEdBQ0EwRCxFQUFBRixFQUFBRyxRQUFBLHVCQUVBRixFQUNBbEksU0FBQSx5QkFDQW9ELFdBQ0F2RCxZQUFBLHlCQUVBc0ksRUFDQW5JLFNBQUEsOEJBQ0FvRCxXQUNBdkQsWUFBQSxnQ0N0QkEsU0FBQWtJLEdBQ0EsSUFBQU0sRUFBQU4sRUFBQUssUUFBQSxpQkFDQUUsRUFBQUQsRUFBQXBJLEtBQUEsd0JBRUFzSSxFQURBRCxFQUFBckksS0FBQSw4QkFDQXVJLFNBRUFILEVBQUFySSxTQUFBLHlCQUNBc0ksRUFBQUUsT0FBQUQsS0FHQUUsZUFBQSxTQUFBSixHQUNBLElBQUFyRixFQUFBcUYsRUFBQXBJLEtBQUEsd0JBQ0FvSSxFQUFBcEksS0FBQSxpQkFFQUosWUFBQSx5QkFDQW1ELEVBQUF3RixPQUFBLElBR0F2SyxFQUFBLGlCQUFBeUQsTUFBQSxTQUFBL0QsR0FDQSxJQUFBc0ssRUFBQWhLLEVBQUFOLEVBQUF5QyxlQUNBaUksRUFBQUosRUFBQUcsUUFBQSxpQkFDQUgsRUFBQUcsUUFBQSxpQkFDQWIsU0FBQSx5QkFDQWtCLGVBQUFKLElBRUFJLGVBQUFKLEdBQ0FMLFNBQUFDIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsZXQgcGxheWVyO1xyXG5cclxuLy8gY29uc3QgcGxheWVyQ29udGFpbmVyID0gJChcIi5wbGF5ZXJcIik7XHJcbi8vIGNvbnN0IHBsYXllclN0YXJ0ID0gJChcIi5wbGF5ZXJfX3N0YXJ0XCIpO1xyXG4vLyBsZXQgZXZlbnRzSW5pdCA9ICgpID0+IHtcclxuLy8gICAkKFwiLnBsYXllcl9fc3RhcnRcIikuY2xpY2soKGUpID0+IHtcclxuLy8gICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuLy8gICAgIGlmIChwbGF5ZXJTdGFydC5oYXNDbGFzcyhcInBsYXllcl9fc3RhcnQtLWFjdGl2ZVwiKSkge1xyXG4vLyAgICAgICBwbGF5ZXIucGF1c2VWaWRlbygpO1xyXG4vLyAgICAgfSBlbHNlIHtcclxuLy8gICAgICAgcGxheWVyLnBsYXlWaWRlbygpO1xyXG4vLyAgICAgfVxyXG4vLyAgIH0pO1xyXG5cclxuLy8gICAkKFwiLnBsYXllcl9fcGxheWJhY2tcIikuY2xpY2soKGUpID0+IHtcclxuLy8gICAgIGNvbnN0IGJhciA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuLy8gICAgIGNvbnN0IGNsaWNrZWRQb3NpdGlvbiA9IGUub3JpZ2luYWxFdmVudC5sYXllclg7XHJcblxyXG4vLyAgICAgY29uc3QgbmV3QnV0dG9uUG9zaXRpb25QZXJjZW50ID0gKGNsaWNrZWRQb3NpdGlvbiAvIGJhci53aWR0aCgpKSAqIDEwMDtcclxuLy8gICAgIGNvbnN0IG5ld1BsYXliYWNrUG9zaXRpb25TZWMgPVxyXG4vLyAgICAgICAocGxheWVyLmdldER1cmF0aW9uKCkgLyAxMDApICogbmV3QnV0dG9uUG9zaXRpb25QZXJjZW50O1xyXG5cclxuLy8gICAgICQoXCIucGxheWVyX19wbGF5YmFjay1saW5lXCIpLmNzcyh7XHJcbi8vICAgICAgIHdpZHRoOiBgJHtuZXdCdXR0b25Qb3NpdGlvblBlcmNlbnR9JWAsXHJcbi8vICAgICB9KTtcclxuXHJcbi8vICAgICBwbGF5ZXIuc2Vla1RvKG5ld1BsYXliYWNrUG9zaXRpb25TZWMpO1xyXG4vLyAgIH0pO1xyXG5cclxuLy8gICAkKFwiLnBsYXllcl9fc3BsYXNoXCIpLmNsaWNrKChlKSA9PiB7XHJcbi8vICAgICBwbGF5ZXIucGxheVZpZGVvKCk7XHJcbi8vICAgfSk7XHJcblxyXG4vLyAgICQoXCIucGxheWVyX192b2x1bWVcIikuY2xpY2soKGUpID0+IHtcclxuLy8gICAgIGNvbnN0IHZCYXIgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbi8vICAgICBjb25zdCB2Q2xpY2tlZFBvc2l0aW9uID0gZS5vcmlnaW5hbEV2ZW50LmxheWVyWDtcclxuLy8gICAgIGNvbnN0IG5ld3ZCdXR0b25Qb3NpdGlvblBlcmNlbnQgPSAodkNsaWNrZWRQb3NpdGlvbiAvIHZCYXIud2lkdGgoKSkgKiAxMDA7XHJcblxyXG4vLyAgICAgJChcIi5wbGF5ZXJfX3ZvbHVtZS1idXR0b25cIikuY3NzKHtcclxuLy8gICAgICAgbGVmdDogYCR7bmV3dkJ1dHRvblBvc2l0aW9uUGVyY2VudH0lYCxcclxuLy8gICAgIH0pO1xyXG5cclxuLy8gICAgIHBsYXllci5zZXRWb2x1bWUobmV3dkJ1dHRvblBvc2l0aW9uUGVyY2VudCk7XHJcbi8vICAgfSk7XHJcbi8vIH07XHJcblxyXG4vLyBjb25zdCBmb3JtYXRUaW1lID0gKHRpbWVTZWMpID0+IHtcclxuLy8gICBjb25zdCByb3VuZFRpbWUgPSBNYXRoLnJvdW5kKHRpbWVTZWMpO1xyXG5cclxuLy8gICBjb25zdCBtaW51dGVzID0gYWRkWmVybyhNYXRoLmZsb29yKHJvdW5kVGltZSAvIDYwKSk7XHJcbi8vICAgY29uc3Qgc2Vjb25kcyA9IGFkZFplcm8ocm91bmRUaW1lIC0gbWludXRlcyAqIDYwKTtcclxuXHJcbi8vICAgZnVuY3Rpb24gYWRkWmVybyhudW0pIHtcclxuLy8gICAgIHJldHVybiBudW0gPCAxMCA/IGAwJHtudW19YCA6IG51bTtcclxuLy8gICB9XHJcblxyXG4vLyAgIHJldHVybiBgJHttaW51dGVzfSA6ICR7c2Vjb25kc31gO1xyXG4vLyB9O1xyXG5cclxuLy8gY29uc3Qgb25QbGF5ZXJSZWFkeSA9ICgpID0+IHtcclxuLy8gICBsZXQgaW50ZXJ2YWw7XHJcbi8vICAgY29uc3QgZHVyYXRpb25TZWMgPSBwbGF5ZXIuZ2V0RHVyYXRpb24oKTtcclxuXHJcbi8vICAgJChcIi5wbGF5ZXJfX2R1cmF0aW9uLWVzdGltYXRlXCIpLnRleHQoZm9ybWF0VGltZShkdXJhdGlvblNlYykpO1xyXG5cclxuLy8gICBpZiAodHlwZW9mIGludGVydmFsICE9PSBcInVuZGVmaW5lZFwiKSB7XHJcbi8vICAgICBjbGVhckludGVydmFsKGludGVydmFsKTtcclxuLy8gICB9XHJcblxyXG4vLyAgIGludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4vLyAgICAgY29uc3QgY29tcGxldGVkU2VjID0gcGxheWVyLmdldEN1cnJlbnRUaW1lKCk7XHJcbi8vICAgICBjb25zdCBjb21wbGV0ZWRQZXJjZW50ID0gKGNvbXBsZXRlZFNlYyAvIGR1cmF0aW9uU2VjKSAqIDEwMDtcclxuXHJcbi8vICAgICAkKFwiLnBsYXllcl9fcGxheWJhY2stbGluZVwiKS5jc3Moe1xyXG4vLyAgICAgICB3aWR0aDogYCR7Y29tcGxldGVkUGVyY2VudH0lYCxcclxuLy8gICAgIH0pO1xyXG4vLyAgICAgJChcIi5wbGF5ZXJfX2R1cmF0aW9uLWNvbXBsZXRlZFwiKS50ZXh0KGZvcm1hdFRpbWUoY29tcGxldGVkU2VjKSk7XHJcbi8vICAgfSwgMTAwMCk7XHJcblxyXG4vLyAgIGNvbnN0IHZvbHVtZU51bWJlciA9IHBsYXllci5nZXRWb2x1bWUoKTtcclxuXHJcbi8vICAgJChcIi5wbGF5ZXJfX3ZvbHVtZS1idXR0b25cIikuY3NzKHtcclxuLy8gICAgIGxlZnQ6IGAke3ZvbHVtZU51bWJlcn0lYCxcclxuLy8gICB9KTtcclxuLy8gfTtcclxuXHJcbi8vIGNvbnN0IG9uUGxheWVyU3RhdGVDaGFuZ2UgPSAoZXZlbnQpID0+IHtcclxuLy8gICAvKlxyXG4vLyAgICAgICAtMSAo0LLQvtGB0L/RgNC+0LjQt9Cy0LXQtNC10L3QuNC1INCy0LjQtNC10L4g0L3QtSDQvdCw0YfQsNGC0L4pXHJcbi8vICAgICAgIDAgKNCy0L7RgdC/0YDQvtC40LfQstC10LTQtdC90LjQtSDQstC40LTQtdC+INC30LDQstC10YDRiNC10L3QvilcclxuLy8gICAgICAgMSAo0LLQvtGB0L/RgNC+0LjQt9Cy0LXQtNC10L3QuNC1KVxyXG4vLyAgICAgICAyICjQv9Cw0YPQt9CwKVxyXG4vLyAgICAgICAzICjQsdGD0YTQtdGA0LjQt9Cw0YbQuNGPKVxyXG4vLyAgICAgICA1ICjQstC40LTQtdC+INC/0L7QtNCw0Y7RgiDRgNC10L/Qu9C40LrQuCkuXHJcbi8vICAgICAqL1xyXG4vLyAgIHN3aXRjaCAoZXZlbnQuZGF0YSkge1xyXG4vLyAgICAgY2FzZSAxOlxyXG4vLyAgICAgICBwbGF5ZXJDb250YWluZXIuYWRkQ2xhc3MoXCJwbGF5ZXItLWFjdGl2ZVwiKTtcclxuLy8gICAgICAgcGxheWVyU3RhcnQuYWRkQ2xhc3MoXCJwbGF5ZXJfX3N0YXJ0LS1hY3RpdmVcIik7XHJcbi8vICAgICAgIGJyZWFrO1xyXG5cclxuLy8gICAgIGNhc2UgMjpcclxuLy8gICAgICAgcGxheWVyQ29udGFpbmVyLnJlbW92ZUNsYXNzKFwicGxheWVyLS1hY3RpdmVcIik7XHJcbi8vICAgICAgIHBsYXllclN0YXJ0LnJlbW92ZUNsYXNzKFwicGxheWVyX19zdGFydC0tYWN0aXZlXCIpO1xyXG4vLyAgICAgICBicmVhaztcclxuLy8gICB9XHJcbi8vIH07XHJcbi8vIGNvbnN0IHBsYXllclZvbHVtZUljb24gPSAkKFwiLnBsYXllcl9fdm9sdW1lLWljb25cIik7XHJcblxyXG4vLyAkKFwiLnBsYXllcl9fdm9sdW1lLWljb25cIikuY2xpY2soKGUpID0+IHtcclxuLy8gICBpZiAocGxheWVyLmdldFZvbHVtZSgpID09IDApIHtcclxuLy8gICAgIHBsYXllci5zZXRWb2x1bWUoXCIxMDBcIik7XHJcbi8vICAgICBwbGF5ZXJWb2x1bWVJY29uLnJlbW92ZUNsYXNzKFwibXV0ZWRcIik7XHJcbi8vICAgICAkKFwiLnBsYXllcl9fdm9sdW1lLWJ1dHRvblwiKS5jc3Moe1xyXG4vLyAgICAgICBsZWZ0OiBgMTAwJWAsXHJcbi8vICAgICB9KTtcclxuLy8gICB9IGVsc2Uge1xyXG4vLyAgICAgcGxheWVyLnNldFZvbHVtZShcIjBcIik7XHJcbi8vICAgICBwbGF5ZXJWb2x1bWVJY29uLmFkZENsYXNzKFwibXV0ZWRcIik7XHJcbi8vICAgICAkKFwiLnBsYXllcl9fdm9sdW1lLWJ1dHRvblwiKS5jc3Moe1xyXG4vLyAgICAgICBsZWZ0OiBgMCVgLFxyXG4vLyAgICAgfSk7XHJcbi8vICAgfVxyXG4vLyB9KTtcclxuXHJcbi8vIGZ1bmN0aW9uIG9uWW91VHViZUlmcmFtZUFQSVJlYWR5KCkge1xyXG4vLyAgIHBsYXllciA9IG5ldyBZVC5QbGF5ZXIoXCJ5dC1wbGF5ZXJcIiwge1xyXG4vLyAgICAgaGVpZ2h0OiBcInJlbSgzOTIpXCIsXHJcbi8vICAgICB3aWR0aDogXCJyZW0oNjYyKVwiLFxyXG4vLyAgICAgdmlkZW9JZDogXCJoazNLUGE2eld6b1wiLFxyXG4vLyAgICAgZXZlbnRzOiB7XHJcbi8vICAgICAgIG9uUmVhZHk6IG9uUGxheWVyUmVhZHksXHJcbi8vICAgICAgIG9uU3RhdGVDaGFuZ2U6IG9uUGxheWVyU3RhdGVDaGFuZ2UsXHJcbi8vICAgICB9LFxyXG4vLyAgICAgcGxheWVyVmFyczoge1xyXG4vLyAgICAgICBjb250cm9sczogMCxcclxuLy8gICAgICAgZGlzYWJsZWtiOiAxLFxyXG4vLyAgICAgICBzaG93aW5mbzogMCxcclxuLy8gICAgICAgcmVsOiAwLFxyXG4vLyAgICAgICBhdXRvcGxheTogMCxcclxuLy8gICAgICAgbW9kZXN0YnJhbmRpbmc6IDAsXHJcbi8vICAgICB9LFxyXG4vLyAgIH0pO1xyXG4vLyB9XHJcbi8vIGV2ZW50c0luaXQoKTtcclxuXHJcblxyXG5cclxuXHJcbmNvbnN0IHBsYXllckJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy52aWRlb19fcGxheWVyLWltZycpO1xyXG5jb25zdCB2aWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF5ZXInKTtcclxuY29uc3QgcGxheWVyUGxheUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wbGF5ZXJfX3N0YXJ0Jyk7XHJcbmNvbnN0IGR1cmF0aW9uQ29udHJvbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkdXJhdGlvbkxldmVsJyk7XHJcbmNvbnN0IHNvdW5kQ29udHJvbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaWNMZXZlbCcpO1xyXG5jb25zdCBzb3VuZEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3VuZCcpO1xyXG5cclxubGV0IGludGVydmFsSWQ7XHJcbmxldCBzb3VuZExldmVsO1xyXG5cclxuLy8gdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRlZGRhdGFcIiwgZnVuY3Rpb24gKCkge1xyXG52aWRlby5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHBsYXlTdG9wKTtcclxuXHJcbmxldCBwbGF5QnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wbGF5Jyk7XHJcblxyXG5mb3IgKGxldCBpID0gMDsgaSA8IHBsYXlCdXR0b25zLmxlbmd0aDsgaSsrKSB7XHJcbiAgcGxheUJ1dHRvbnNbaV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBwbGF5U3RvcCk7XHJcbn1cclxuXHJcbmR1cmF0aW9uQ29udHJvbC5taW4gPSAwO1xyXG5kdXJhdGlvbkNvbnRyb2wudmFsdWUgPSAwO1xyXG5kdXJhdGlvbkNvbnRyb2wubWF4ID0gdmlkZW8uZHVyYXRpb247XHJcbmR1cmF0aW9uQ29udHJvbC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIHNldFZpZGVvRHVyYXRpb24pO1xyXG5cclxuc291bmRDb250cm9sLm1pbiA9IDA7XHJcbnNvdW5kQ29udHJvbC5tYXggPSAxMDtcclxuc291bmRDb250cm9sLnZhbHVlID0gc291bmRDb250cm9sLm1heDtcclxuc291bmRDb250cm9sLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgY2hhbmdlU291bmRWb2x1bWUpO1xyXG5cclxuc291bmRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzb3VuZE9mKTtcclxudmlkZW8uYWRkRXZlbnRMaXN0ZW5lcignZW5kZWQnLCAoKSA9PiB7XHJcbiAgcGxheWVyQnRuLmNsYXNzTGlzdC50b2dnbGUoJ3ZpZGVvX19wbGF5ZXItaW1nLS1hY3RpdmUnKTtcclxuICBwbGF5ZXJQbGF5QnRuLmNsYXNzTGlzdC5yZW1vdmUoJ3BsYXllcl9fc3RhcnQtLWFjdGl2ZScpO1xyXG4gIHZpZGVvLmN1cnJlbnRUaW1lID0gMDtcclxufSlcclxuLy8gfSk7XHJcblxyXG5cclxuZnVuY3Rpb24gcGxheVN0b3AoKSB7XHJcbiAgcGxheWVyQnRuLmNsYXNzTGlzdC50b2dnbGUoJ3ZpZGVvX19wbGF5ZXItaW1nLS1hY3RpdmUnKTtcclxuICBwbGF5ZXJQbGF5QnRuLmNsYXNzTGlzdC50b2dnbGUoJ3BsYXllcl9fc3RhcnQtLWFjdGl2ZScpO1xyXG4gIGlmICh2aWRlby5wYXVzZWQpIHtcclxuICAgIHZpZGVvLnBsYXkoKTtcclxuICAgIGludGVydmFsSWQgPSBzZXRJbnRlcnZhbCh1cGRhdGVEdXJhdGlvbiwgMTAwMCAvIDYwKTtcclxuXHJcbiAgfSBlbHNlIHtcclxuICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxJZCk7XHJcbiAgICB2aWRlby5wYXVzZSgpO1xyXG5cclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldFZpZGVvRHVyYXRpb24oKSB7XHJcbiAgdmlkZW8uY3VycmVudFRpbWUgPSBkdXJhdGlvbkNvbnRyb2wudmFsdWU7XHJcbiAgdXBkYXRlRHVyYXRpb24oKTtcclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlRHVyYXRpb24oKSB7XHJcbiAgZHVyYXRpb25Db250cm9sLnZhbHVlID0gdmlkZW8uY3VycmVudFRpbWU7XHJcbiAgbGV0IHN0ZXAgPSB2aWRlby5kdXJhdGlvbiAvIDEwMDtcclxuICBsZXQgcGVyY2VudCA9IHZpZGVvLmN1cnJlbnRUaW1lIC8gc3RlcDtcclxuICBkdXJhdGlvbkNvbnRyb2wuc3R5bGUuYmFja2dyb3VuZCA9IGBsaW5lYXItZ3JhZGllbnQoOTBkZWcsICNGRjAwMDAgMCUsICNGRjAwMDAgJHtwZXJjZW50fSUsICM2MjYyNjIgJHtwZXJjZW50fSUpYDtcclxufVxyXG5cclxuZnVuY3Rpb24gY2hhbmdlU291bmRWb2x1bWUoKSB7XHJcbiAgdmlkZW8udm9sdW1lID0gc291bmRDb250cm9sLnZhbHVlIC8gMTA7XHJcbiAgaWYgKHZpZGVvLnZvbHVtZSA9PSAwKSB7XHJcbiAgICBzb3VuZEJ0bi5jbGFzc0xpc3QuYWRkKFwibXV0ZWRcIik7XHJcbiAgfSBlbHNlIHtcclxuICAgIHNvdW5kQnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJtdXRlZFwiKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNvdW5kT2YoKSB7XHJcbiAgaWYgKHZpZGVvLnZvbHVtZSA9PSAwKSB7XHJcbiAgICAgIHZpZGVvLnZvbHVtZSA9IHNvdW5kTGV2ZWw7XHJcbiAgICAgIHNvdW5kQ29udHJvbC52YWx1ZSA9IHNvdW5kTGV2ZWwgKiAxMDtcclxuICAgICAgc291bmRCdG4uY2xhc3NMaXN0LnJlbW92ZShcIm11dGVkXCIpO1xyXG4gIH0gZWxzZSB7XHJcbnNvdW5kTGV2ZWwgPSB2aWRlby52b2x1bWU7XHJcbnZpZGVvLnZvbHVtZSA9IDA7XHJcbnNvdW5kQ29udHJvbC52YWx1ZSA9IDA7XHJcbnNvdW5kQnRuLmNsYXNzTGlzdC5hZGQoXCJtdXRlZFwiKTtcclxuICB9XHJcbn0iLCJsZXQgYnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2hhbWJ1cmdlcl9fY29udGFpbmVyJyk7XHJcbmxldCBtZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2Z1bGxzY3JlZW4tbWVudScpOyAgXHJcbmxldCBoYW1idXJnZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjaGFtYnVyZ2VyJylcclxubGV0IGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XHJcblxyXG4vLyBsZXQgdG9nZ2xlTWVudSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgXHJcbi8vICAgICBidXR0b24uY2xhc3NMaXN0LnRvZ2dsZSgnaGFtYnVyZ2VyX19jb250YWluZXItLWFjdGl2ZScpO1xyXG4vLyAgICAgaGFtYnVyZ2VyLmNsYXNzTGlzdC50b2dnbGUoJ2hhbWJ1cmdlci0tYWN0aXZlJylcclxuLy8gICAgIG1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnZnVsbHNjcmVlbi1tZW51LS1vcGVuJyk7XHJcbiAgICAvLyBib2R5LmNsYXNzTGlzdC50b2dnbGUoJ2JvZHktYWN0aXZlLW1lbnUnKTtcclxuLy8gfTtcclxuXHJcbi8vIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsaWNrTWVudSA9PiB7XHJcbi8vICAgICBjbGlja01lbnUucHJldmVudERlZmF1bHQoKTtcclxuLy8gICAgIGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKCdoYW1idXJnZXJfX2NvbnRhaW5lci0tYWN0aXZlJyk7XHJcbi8vICAgICBoYW1idXJnZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaGFtYnVyZ2VyLS1hY3RpdmUnKVxyXG4vLyAgICAgbWVudS5jbGFzc0xpc3QudG9nZ2xlKCdmdWxsc2NyZWVuLW1lbnUtLW9wZW4nKTtcclxuLy8gICAgIGJvZHkuY2xhc3NMaXN0LnRvZ2dsZSgnYm9keS1hY3RpdmUtbWVudScpO1xyXG4vLyAgICAgLy8gJCgnLm1lbnVfX2xpbmsnKS5vbignY2xpY2snLCBjbGlja01lbnUpO1xyXG4vLyB9KTsgICBcclxuLy8gJCgnLm1lbnVfX2xpbmsnKS5vbignY2xpY2snLCBjbGlja01lbnUpO1xyXG5cclxubGV0IHRvZ2dsZU1lbnUgPSBmdW5jdGlvbihlKSB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBidXR0b24uY2xhc3NMaXN0LnRvZ2dsZSgnaGFtYnVyZ2VyX19jb250YWluZXItLWFjdGl2ZScpO1xyXG4gICAgaGFtYnVyZ2VyLmNsYXNzTGlzdC50b2dnbGUoJ2hhbWJ1cmdlci0tYWN0aXZlJylcclxuICAgIG1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnZnVsbHNjcmVlbi1tZW51LS1vcGVuJyk7XHJcbiAgICAvLyBib2R5LmNsYXNzTGlzdC50b2dnbGUoJ2JvZHktYWN0aXZlLW1lbnUnKTtcclxuICAgIGJvZHkuY2xhc3NMaXN0LnRvZ2dsZSgnbG9ja2VkJyk7XHJcbn1cclxuXHJcbmJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRvZ2dsZU1lbnUpOyAgIFxyXG4kKCcuZnVsbHNjcmVlbi1tZW51X19saW5rJykub24oJ2NsaWNrJywgdG9nZ2xlTWVudSk7XHJcbiIsImxldCBteU1hcDtcclxuY29uc3QgaW5pdCA9ICgpID0+IHtcclxuICBteU1hcCA9IG5ldyB5bWFwcy5NYXAoXCJtYXBcIiwge1xyXG4gICAgY2VudGVyOiBbNTUuNzUyMTM3LCAzNy41ODkzMzVdLFxyXG4gICAgem9vbTogMTMsXHJcbiAgICBjb250cm9sczogW10sXHJcbiAgfSk7XHJcblxyXG4gIGxldCBjb29yZHMgPSBbXHJcbiAgICAgIFs1NS43NTYwMTIsIDM3LjYwNDAyMV0sXHJcbiAgICAgIFs1NS43NTA5MiwgMzcuNjE1NzQ2XSxcclxuICAgICAgWzU1Ljc0Njk4OCwgMzcuNTkxNzE1XSxcclxuICAgICAgWzU1Ljc0NDA3OCwgMzcuNTkxNDEzXSxcclxuICAgIF0sXHJcbiAgICBteUNvbGxlY3Rpb24gPSBuZXcgeW1hcHMuR2VvT2JqZWN0Q29sbGVjdGlvbihcclxuICAgICAge30sXHJcbiAgICAgIHtcclxuICAgICAgICBkcmFnZ2FibGU6IGZhbHNlLFxyXG4gICAgICAgIGljb25MYXlvdXQ6IFwiZGVmYXVsdCNpbWFnZVwiLFxyXG4gICAgICAgIGljb25JbWFnZUhyZWY6IFwiLi9pbWcvbWFya2VyOC5wbmdcIixcclxuICAgICAgICBpY29uSW1hZ2VTaXplOiBbNDYsIDU3XSxcclxuICAgICAgICBpY29uSW1hZ2VPZmZzZXQ6IFstMzUsIC01Ml0sXHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgY29vcmRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICBteUNvbGxlY3Rpb24uYWRkKG5ldyB5bWFwcy5QbGFjZW1hcmsoY29vcmRzW2ldKSk7XHJcbiAgfVxyXG5cclxuICBteU1hcC5nZW9PYmplY3RzLmFkZChteUNvbGxlY3Rpb24pO1xyXG5cclxuICBteU1hcC5iZWhhdmlvcnMuZGlzYWJsZShcInNjcm9sbFpvb21cIik7XHJcbn07XHJcblxyXG55bWFwcy5yZWFkeShpbml0KTtcclxuIiwiY29uc3QgdmFsaWRhdGVGaWVsZHMgPSAoZm9ybSwgZmllbGRzQXJyYXkpID0+IHtcclxuICBmaWVsZHNBcnJheS5mb3JFYWNoKChmaWVsZCkgPT4ge1xyXG4gICAgZmllbGQucmVtb3ZlQ2xhc3MoXCJpbnB1dC1lcnJvclwiKTtcclxuICAgIGlmIChmaWVsZC52YWwoKS50cmltKCkgPT0gXCJcIikge1xyXG4gICAgICBmaWVsZC5hZGRDbGFzcyhcImlucHV0LWVycm9yXCIpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICBjb25zdCBlcnJvckZpZWxkcyA9IGZvcm0uZmluZChcIi5pbnB1dC1lcnJvclwiKTtcclxuXHJcbiAgcmV0dXJuIGVycm9yRmllbGRzLmxlbmd0aCA9PSAwO1xyXG59O1xyXG5cclxuJChcIi5mb3JtXCIpLnN1Ym1pdCgoZSkgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgY29uc3QgZm9ybSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCBuYW1lID0gZm9ybS5maW5kKFwiW25hbWU9J25hbWUnXVwiKTtcclxuICBjb25zdCBwaG9uZSA9IGZvcm0uZmluZChcIltuYW1lPSdwaG9uZSddXCIpO1xyXG4gIGNvbnN0IGNvbW1lbnQgPSBmb3JtLmZpbmQoXCJbbmFtZT0nY29tbWVudCddXCIpO1xyXG4gIGNvbnN0IHRvID0gZm9ybS5maW5kKFwiW25hbWU9J3RvJ11cIik7XHJcbiAgY29uc3QgbW9kYWwgPSAkKFwiI21vZGFsXCIpO1xyXG4gIGNvbnN0IGNvbnRlbnQgPSBtb2RhbC5maW5kKFwiLm1vZGFsX19jb250ZW50XCIpO1xyXG5cclxuICBtb2RhbC5yZW1vdmVDbGFzcyhcImVycm9yLW1vZGFsXCIpO1xyXG5cclxuICBjb25zdCBpc1ZhbGlkID0gdmFsaWRhdGVGaWVsZHMoZm9ybSwgW25hbWUsIHBob25lLCBjb21tZW50LCB0b10pO1xyXG5cclxuICBpZiAoaXNWYWxpZCkge1xyXG4gICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCdsb2NrZWQnKTtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSAkLmFqYXgoe1xyXG4gICAgICB1cmw6IFwiaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsXCIsXHJcbiAgICAgIG1ldGhvZDogXCJwb3N0XCIsXHJcbiAgICAgIGRhdGE6IHtcclxuICAgICAgICBuYW1lOiBuYW1lLnZhbCgpLFxyXG4gICAgICAgIHBob25lOiBwaG9uZS52YWwoKSxcclxuICAgICAgICBjb21tZW50OiBjb21tZW50LnZhbCgpLFxyXG4gICAgICAgIHRvOiB0by52YWwoKSxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIHJlcXVlc3QuZG9uZSgoZGF0YSkgPT4ge1xyXG4gICAgICBjb250ZW50LnRleHQoZGF0YS5tZXNzYWdlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJlcXVlc3QuZmFpbCgoZGF0YSkgPT4ge1xyXG4gICAgICBjb25zdCBtZXNzYWdlID0gZGF0YS5yZXNwb25zZUpTT04ubWVzc2FnZTtcclxuICAgICAgY29udGVudC50ZXh0KG1lc3NhZ2UpO1xyXG4gICAgICBtb2RhbC5hZGRDbGFzcyhcImVycm9yLW1vZGFsXCIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmVxdWVzdC5hbHdheXMoKCkgPT4ge1xyXG4gICAgICAkLmZhbmN5Ym94Lm9wZW4oe1xyXG4gICAgICAgIHNyYzogXCIjbW9kYWxcIixcclxuICAgICAgICB0eXBlOiBcImlubGluZVwiLFxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH1cclxufSk7XHJcblxyXG4kKFwiLmFwcC1jbG9zZS1tb2RhbFwiKS5jbGljaygoZSkgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdsb2NrZWQnKTtcclxuXHJcbiAgJC5mYW5jeWJveC5jbG9zZSgpO1xyXG59KTtcclxuIiwiY29uc3Qgc2VjdGlvbnMgPSAkKFwic2VjdGlvblwiKTtcclxuY29uc3QgZGlzcGxheSA9ICQoXCIubWFpbmNvbnRlbnRcIik7XHJcbmNvbnN0IHNpZGVNZW51ID0gJChcIi5maXhlZC1tZW51XCIpO1xyXG5jb25zdCBtZW51SXRlbXMgPSBzaWRlTWVudS5maW5kKFwiZml4ZWQtbWVudV9faXRlbVwiKTtcclxuXHJcbmNvbnN0IG1vYmlsZURldGVjdCA9IG5ldyBNb2JpbGVEZXRlY3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpO1xyXG5jb25zdCBpc01vYmlsZSA9IG1vYmlsZURldGVjdC5tb2JpbGUoKTtcclxuXHJcbmxldCBpblNjcm9sbCA9IGZhbHNlO1xyXG5cclxuc2VjdGlvbnMuZmlyc3QoKS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcclxuXHJcbmNvbnN0IGNvdW50U2VjdGlvblBvc2l0aW9uID0gKHNlY3Rpb25FcSkgPT4ge1xyXG5cclxuICAgIGNvbnN0IHBvc2l0aW9uID0gc2VjdGlvbkVxICogLTEwMDtcclxuXHJcbiAgICBpZiAoaXNOYU4ocG9zaXRpb24pKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcItC/0LXRgNC10LTQsNC90L4g0L3QtSDQstC10YDQvdC+0LUg0LfQvdCw0YfQtdC90LjQtSDQsiBjb3VudFNlY3Rpb25Qb3NpdGlvblwiKTtcclxuICAgICAgICByZXR1cm4gMDtcclxuICAgIH1cclxuICAgIHJldHVybiBwb3NpdGlvbjtcclxufVxyXG5cclxuY29uc3QgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0gPSAoaXRlbXMsIGl0ZW1FcSwgYWN0aXZlQ2xhc3MpID0+IHtcclxuICAgIGl0ZW1zLmVxKGl0ZW1FcSkuYWRkQ2xhc3MoYWN0aXZlQ2xhc3MpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoYWN0aXZlQ2xhc3MpO1xyXG59XHJcblxyXG5jb25zdCBwZXJmb3JtVHJhbnNpdGlvbiA9IChzZWN0aW9uRXEpID0+IHtcclxuXHJcbiAgICBpZiAoaW5TY3JvbGwgfHwgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuY29udGFpbnMoJ2xvY2tlZCcpKSByZXR1cm47XHJcblxyXG4gICAgY29uc3QgdHJhbnNpdGlvbk92ZXIgPSAxMDAwO1xyXG4gICAgY29uc3QgbW91c2VJbmVydGlhT3ZlciA9IDMwMDtcclxuICAgIGluU2Nyb2xsID0gdHJ1ZTtcclxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IGNvdW50U2VjdGlvblBvc2l0aW9uKHNlY3Rpb25FcSk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgZGlzcGxheS5jc3Moe1xyXG4gICAgICAgICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGVZKCR7cG9zaXRpb259JSlgLFxyXG4gICAgICAgIH0pO1xyXG4gICAgXHJcbiAgICAgICAgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0oc2VjdGlvbnMsIHNlY3Rpb25FcSwgXCJhY3RpdmVcIik7XHJcbiAgICAgICAgc2VjdGlvbnMuZXEoc2VjdGlvbkVxKS5hZGRDbGFzcyhcImFjdGl2ZVwiKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xyXG5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIGluU2Nyb2xsID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtKG1lbnVJdGVtcywgc2VjdGlvbkVxLCBcImZpeGVkLW1lbnVfX2l0ZW0tLWFjdGl2ZVwiKTtcclxuXHJcblxyXG4gICAgICAgIHNpZGVNZW51XHJcbiAgICAgICAgLmZpbmQoXCIuZml4ZWQtbWVudV9faXRlbVwiKVxyXG4gICAgICAgIC5lcShzZWN0aW9uRXEpXHJcbiAgICAgICAgLmFkZENsYXNzKFwiZml4ZWQtbWVudV9faXRlbS0tYWN0aXZlXCIpXHJcbiAgICAgICAgLnNpYmxpbmdzKClcclxuICAgICAgICAucmVtb3ZlQ2xhc3MoXCJmaXhlZC1tZW51X19pdGVtLS1hY3RpdmVcIik7XHJcbiAgICB9LCB0cmFuc2l0aW9uT3ZlciArIG1vdXNlSW5lcnRpYU92ZXIpO1xyXG4gICAgXHJcbiAgXHJcbn07XHJcblxyXG5jb25zdCB2aWV3cG9ydFNjcm9sbGVyID0gKCkgPT4ge1xyXG4gICAgY29uc3QgYWN0aXZlU2VjdGlvbiA9IHNlY3Rpb25zLmZpbHRlcihcIi5hY3RpdmVcIik7XHJcbiAgICBjb25zdCBuZXh0U2VjdGlvbiA9IGFjdGl2ZVNlY3Rpb24ubmV4dCgpO1xyXG4gICAgY29uc3QgcHJldlNlY3Rpb24gPSBhY3RpdmVTZWN0aW9uLnByZXYoKTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIG5leHQoKSB7XHJcbiAgICAgICAgICAgIGlmKG5leHRTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgcGVyZm9ybVRyYW5zaXRpb24obmV4dFNlY3Rpb24uaW5kZXgoKSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcHJldigpIHtcclxuICAgICAgICAgICAgaWYocHJldlNlY3Rpb24ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBwZXJmb3JtVHJhbnNpdGlvbihwcmV2U2VjdGlvbi5pbmRleCgpKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgIH1cclxuXHJcblxyXG5cclxuXHJcbn07XHJcblxyXG4kKHdpbmRvdykub24oXCJ3aGVlbFwiLCBlPT4ge1xyXG5jb25zdCBkZWx0YVkgPSBlLm9yaWdpbmFsRXZlbnQuZGVsdGFZO1xyXG5jb25zdCBzY3JvbGxlciA9IHZpZXdwb3J0U2Nyb2xsZXIoKTtcclxuXHJcbmlmIChkZWx0YVkgPiAwKSB7XHJcbiAgICBzY3JvbGxlci5uZXh0KCk7XHJcbi8vIHNjcm9sbFZpZXdwb3J0KFwibmV4dFwiKTtcclxufVxyXG5pZiAoZGVsdGFZIDwgMCkge1xyXG4gICAgc2Nyb2xsZXIucHJldigpO1xyXG4gICAgLy8gc2Nyb2xsVmlld3BvcnQoXCJwcmV2XCIpO1xyXG59XHJcbn0pO1xyXG5cclxuJCh3aW5kb3cpLm9uKFwia2V5ZG93blwiLCAoZSkgPT4ge1xyXG5cclxuICAgIGNvbnN0IHRhZ05hbWUgPSBlLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICBjb25zdCB1c2VyVHlwaW5nSW5JbnB1dHMgPSB0YWdOYW1lID09IFwiaW5wdXRcIiB8fCB0YWdOYW1lID09IFwidGV4dGFyZWFcIiA7XHJcbiAgICBjb25zdCBzY3JvbGxlciA9IHZpZXdwb3J0U2Nyb2xsZXIoKTtcclxuXHJcbiAgICBpZih1c2VyVHlwaW5nSW5JbnB1dHMpIHJldHVybjtcclxuXHJcbiAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XHJcbiAgICBjYXNlIDM4OlxyXG4gICAgICAgIHNjcm9sbGVyLnByZXYoKTtcclxuICAgICAgICBicmVhaztcclxuICAgXHJcbiAgICAgICAgY2FzZSA0MDpcclxuICAgICAgICAgICAgc2Nyb2xsZXIubmV4dCgpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgIFxyXG4gICB9IFxyXG5cclxufSk7XHJcblxyXG4kKFwiLndyYXBwZXJcIikub24oXCJ0b3VjaG1vdmVcIiwgZSA9PiBlLnByZXZlbnREZWZhdWx0KCkpO1xyXG5cclxuJChcIltkYXRhLXNjcm9sbC10b11cIikuY2xpY2soZT0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgIGNvbnN0IHRhcmdldCA9ICR0aGlzLmF0dHIoXCJkYXRhLXNjcm9sbC10b1wiKTtcclxuICAgIGNvbnN0IHJlcVNlY3Rpb24gPSAkKGBbZGF0YS1zZWN0aW9uLWlkPSR7dGFyZ2V0fV1gKTtcclxuXHJcbiAgICBwZXJmb3JtVHJhbnNpdGlvbihyZXFTZWN0aW9uLmluZGV4KCkpO1xyXG59KTtcclxuXHJcbmlmIChpc01vYmlsZSkge1xyXG4vL2h0dHBzOi8vZ2l0aHViLmNvbS9tYXR0YnJ5c29uL1RvdWNoU3dpcGUtSnF1ZXJ5LVBsdWdpblxyXG4kKFwiYm9keVwiKS5zd2lwZSgge1xyXG4gICAgc3dpcGU6IGZ1bmN0aW9uIChldmVudCwgZGlyZWN0aW9uLCkge1xyXG4gICAgICAgIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG4gICAgICAgIGxldCBzY3JvbGxEaXJlY3Rpb24gPSBcIlwiO1xyXG5cclxuICAgICAgICBpZiAoZGlyZWN0aW9uID09IFwidXBcIikgc2Nyb2xsRGlyZWN0aW9uID0gXCJuZXh0XCI7IFxyXG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT0gXCJkb3duXCIpIHNjcm9sbERpcmVjdGlvbiA9IFwicHJldlwiOyBcclxuXHJcblxyXG4gICAgICBpZiAoc2Nyb2xsRGlyZWN0aW9uKSB7XHJcbiAgICAgICAgc2Nyb2xsZXJbc2Nyb2xsRGlyZWN0aW9uXSgpO1xyXG4gICAgICB9XHJcbiAgICAgICAgXHJcbiAgICB9XHJcbiAgfSk7XHJcbn0iLCJjb25zdCBsaXN0ID0gJChcIi5wcm9kdWN0cy1tZW51X19saXN0XCIpO1xyXG5cclxubGlzdC5vbihcImNsaWNrXCIsIFwiLnByb2R1Y3RcIiwgZnVuY3Rpb24gKGUpIHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgJCh0aGlzKS5zaWJsaW5ncyhcImxpXCIpLnJlbW92ZUNsYXNzKFwicHJvZHVjdC0tYWN0aXZlXCIpO1xyXG4gICQodGhpcykudG9nZ2xlQ2xhc3MoXCJwcm9kdWN0LS1hY3RpdmVcIik7XHJcbiAgbGV0ICRjb250ZW50ID0gJCh0aGlzKS5maW5kKFwiLnByb2R1Y3RfX2NvbnRlbnRcIik7XHJcblxyXG4gIGxldCBjdXJXaWR0aCA9IDA7XHJcbiAgbGV0IG5ld1dpZHRoID0gNTI0O1xyXG5cclxuICBpZiAoJCh3aW5kb3cpLndpZHRoKCkgPD0gNzY4ICYmICQod2luZG93KS53aWR0aCgpID4gNDgwKSB7XHJcbiAgICBjdXJXaWR0aCA9ICQoXCIucHJvZHVjdF9fdGl0bGVcIikud2lkdGgoKSAqICQoXCIucHJvZHVjdF9fdGl0bGVcIikubGVuZ3RoO1xyXG4gICAgbmV3V2lkdGggPSAkKHdpbmRvdykud2lkdGgoKSAtIGN1cldpZHRoO1xyXG4gIH1cclxuXHJcbiAgaWYgKCQod2luZG93KS53aWR0aCgpIDw9IDQ4MCkge1xyXG4gICAgY3VyV2lkdGggPSAkKFwiLnByb2R1Y3RfX3RpdGxlXCIpLndpZHRoKCk7XHJcbiAgICBuZXdXaWR0aCA9ICQod2luZG93KS53aWR0aCgpIC0gY3VyV2lkdGg7XHJcbiAgfVxyXG5cclxuICBsaXN0LmZpbmQoXCIucHJvZHVjdF9fY29udGVudFwiKS5jc3MoXCJ3aWR0aFwiLCAwKTtcclxuXHJcbiAgaWYgKCQodGhpcykuaGFzQ2xhc3MoXCJwcm9kdWN0LS1hY3RpdmVcIikpIHtcclxuICAgICRjb250ZW50LmNzcyhcIndpZHRoXCIsIGAke25ld1dpZHRofXB4YCk7XHJcbiAgfVxyXG59KTtcclxuIiwiY29uc3Qgc2xpZGVyID0gJChcIi5zaG9wX19saXN0XCIpLmJ4U2xpZGVyKHtcclxuICBwYWdlcjogZmFsc2UsXHJcbiAgY29udHJvbHM6IGZhbHNlLFxyXG59KTtcclxuXHJcbiQoXCIuc2hvcF9fYnRuX2xlZnRcIikuY2xpY2soKGUpID0+IHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gIHNsaWRlci5nb1RvUHJldlNsaWRlKCk7XHJcbn0pO1xyXG4kKFwiLnNob3BfX2J0bl9yaWdodFwiKS5jbGljaygoZSkgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgc2xpZGVyLmdvVG9OZXh0U2xpZGUoKTtcclxufSk7XHJcbiIsImNvbnN0IGZpbmRCbG9ja0J5QWxpYXMgPSAoYWxpYXMpID0+IHtcclxuICByZXR1cm4gJChcIi5yZXZpZXdzX19pdGVtXCIpLmZpbHRlcigobmR4LCBpdGVtKSA9PiB7XHJcbiAgICByZXR1cm4gJChpdGVtKS5hdHRyKFwiZGF0YS1saW5rZWQtd2l0aFwiKSA9PSBhbGlhcztcclxuICB9KTtcclxufTtcclxuXHJcbiQoXCIuaW50ZXJhY3RpdmUtYXZhdGFyX19saW5rXCIpLmNsaWNrKChlKSA9PiB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCB0YXJnZXQgPSAkdGhpcy5hdHRyKFwiZGF0YS1vcGVuXCIpO1xyXG4gIGNvbnN0IGl0ZW1Ub1Nob3cgPSBmaW5kQmxvY2tCeUFsaWFzKHRhcmdldCk7XHJcbiAgY29uc3QgY3VySXRlbSA9ICR0aGlzLmNsb3Nlc3QoXCIuaW50ZXJhY3RpdmUtYXZhdGFyXCIpO1xyXG5cclxuICBpdGVtVG9TaG93XHJcbiAgICAuYWRkQ2xhc3MoXCJyZXZpZXdzX19pdGVtLS1hY3RpdmVcIilcclxuICAgIC5zaWJsaW5ncygpXHJcbiAgICAucmVtb3ZlQ2xhc3MoXCJyZXZpZXdzX19pdGVtLS1hY3RpdmVcIik7XHJcblxyXG4gIGN1ckl0ZW1cclxuICAgIC5hZGRDbGFzcyhcImludGVyYWN0aXZlLWF2YXRhci0tYWN0aXZlXCIpXHJcbiAgICAuc2libGluZ3MoKVxyXG4gICAgLnJlbW92ZUNsYXNzKFwiaW50ZXJhY3RpdmUtYXZhdGFyLS1hY3RpdmVcIik7XHJcbn0pO1xyXG4iLCJjb25zdCBvcGVuSXRlbSA9IChpdGVtKSA9PiB7XHJcbiAgY29uc3QgY29udGFpbmVyID0gaXRlbS5jbG9zZXN0KFwiLnNsaWRlcl9faXRlbVwiKTtcclxuICBjb25zdCBjb250ZW50QmxvY2sgPSBjb250YWluZXIuZmluZChcIi5zbGlkZXJfX2Rlc2NyaXB0aW9uXCIpO1xyXG4gIGNvbnN0IHRleHRCbG9jayA9IGNvbnRlbnRCbG9jay5maW5kKFwiLnNsaWRlcl9fZGVzY3JpcHRpb24tLXdyYXBcIik7XHJcbiAgY29uc3QgcmVxSGVpZ2h0ID0gdGV4dEJsb2NrLmhlaWdodCgpO1xyXG5cclxuICBjb250YWluZXIuYWRkQ2xhc3MoXCIuc2xpZGVyX19pdGVtLS1hY3RpdmVcIik7XHJcbiAgY29udGVudEJsb2NrLmhlaWdodChyZXFIZWlnaHQpO1xyXG59O1xyXG5cclxuY29uc3QgY2xvc2VFdmVyeUl0ZW0gPSAoY29udGFpbmVyKSA9PiB7XHJcbiAgY29uc3QgaXRlbXMgPSBjb250YWluZXIuZmluZChcIi5zbGlkZXJfX2Rlc2NyaXB0aW9uXCIpO1xyXG4gIGNvbnN0IGl0ZW1Db250YWluZXIgPSBjb250YWluZXIuZmluZChcIi5zbGlkZXJfX2l0ZW1cIik7XHJcblxyXG4gIGl0ZW1Db250YWluZXIucmVtb3ZlQ2xhc3MoXCIuc2xpZGVyX19pdGVtLS1hY3RpdmVcIik7XHJcbiAgaXRlbXMuaGVpZ2h0KDApO1xyXG59O1xyXG5cclxuJChcIi5zbGlkZXJfX25hbWVcIikuY2xpY2soKGUpID0+IHtcclxuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCBjb250YWluZXIgPSAkdGhpcy5jbG9zZXN0KFwiLnNsaWRlcl9fbGlzdFwiKTtcclxuICBjb25zdCBlbGVtQ29udGFpbmVyID0gJHRoaXMuY2xvc2VzdChcIi5zbGlkZXJfX2l0ZW1cIik7XHJcbiAgaWYgKGVsZW1Db250YWluZXIuaGFzQ2xhc3MoXCIuc2xpZGVyX19pdGVtLS1hY3RpdmVcIikpIHtcclxuICAgIGNsb3NlRXZlcnlJdGVtKGNvbnRhaW5lcik7XHJcbiAgfSBlbHNlIHtcclxuICAgIGNsb3NlRXZlcnlJdGVtKGNvbnRhaW5lcik7XHJcbiAgICBvcGVuSXRlbSgkdGhpcyk7XHJcbiAgfVxyXG59KTtcclxuIl19
